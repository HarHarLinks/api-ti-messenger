<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1412px" preserveAspectRatio="none" style="width:1300px;height:1412px;background:#FFFFFF;" version="1.1" viewBox="0 0 1300 1412" width="1300px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="1400.0859" style="stroke:#181818;stroke-width:0.5;" width="670" x="524" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="171" x="771.5" y="24.6855">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="942.5" y="25.7842"> </text><rect fill="#DCDCDC" height="1271.1328" style="stroke:#000000;stroke-width:1.0;" width="10" x="132" y="82.7969"/><rect fill="#DCDCDC" height="46.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="137" y="1186.1641"/><rect fill="#DCDCDC" height="105.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="630" y="213.8984"/><rect fill="#DCDCDC" height="105.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="854" y="382.8125"/><rect fill="#DCDCDC" height="544.6719" style="stroke:#000000;stroke-width:1.0;" width="10" x="1078" y="598.1094"/><rect fill="none" height="406.1641" style="stroke:#000000;stroke-width:1.5;" width="1068" x="10" y="89.7969"/><rect fill="none" height="206.7734" style="stroke:#000000;stroke-width:1.5;" width="826" x="20" y="120.2734"/><rect fill="#FFB6C1" height="123.0078" style="stroke:#000000;stroke-width:1.5;" width="1180" x="20" y="682.875"/><rect fill="none" height="359.8984" style="stroke:#000000;stroke-width:1.5;" width="1180" x="20" y="961.0313"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="137" x2="137" y1="72.7969" y2="1362.9297"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="635" x2="635" y1="72.7969" y2="1362.9297"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="859" x2="859" y1="72.7969" y2="1362.9297"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1083" x2="1083" y1="72.7969" y2="1362.9297"/><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="30" y="32.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="188" x="43" y="60.4023">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="30" y="1361.9297"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="188" x="43" y="1389.6914">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="528" y="32.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="127" x="571.5" y="60.4023">OAuth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="528" y="1361.9297"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="127" x="571.5" y="1389.6914">OAuth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="752" y="32.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="803.5" y="60.4023">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="752" y="1361.9297"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="803.5" y="1389.6914">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="976" y="32.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="1032" y="60.4023">FHIR-Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="976" y="1361.9297"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="1032" y="1389.6914">FHIR-Proxy</text><rect fill="#DCDCDC" height="1271.1328" style="stroke:#000000;stroke-width:1.0;" width="10" x="132" y="82.7969"/><rect fill="#DCDCDC" height="46.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="137" y="1186.1641"/><rect fill="#DCDCDC" height="105.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="630" y="213.8984"/><rect fill="#DCDCDC" height="105.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="854" y="382.8125"/><rect fill="#DCDCDC" height="544.6719" style="stroke:#000000;stroke-width:1.0;" width="10" x="1078" y="598.1094"/><path d="M10,89.7969 L71,89.7969 L71,98.1484 L61,108.1484 L10,108.1484 L10,89.7969 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="406.1641" style="stroke:#000000;stroke-width:1.5;" width="1068" x="10" y="89.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="104.292">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="86" y="109.5049">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="354" x="90" y="108.4063">kein gültiges provider-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="444" y="109.5049">]</text><path d="M20,120.2734 L81,120.2734 L81,128.625 L71,138.625 L20,138.625 L20,120.2734 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="206.7734" style="stroke:#000000;stroke-width:1.5;" width="826" x="20" y="120.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="134.7686">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="96" y="139.9814">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="289" x="100" y="138.8828">Benötigt IDP-TI-Provider-Accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="389" y="139.9814">]</text><polygon fill="#000000" points="618,209.8984,628,213.8984,618,217.8984,622,213.8984" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="624" y1="213.8984" y2="213.8984"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="149" y="186.7803">1</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="448" x="162" y="165.3975">POST /auth/realms/TI-Provider/protocol/openid-connect/token</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="174" x="162" y="186.7803">(client_id, client_secret)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="162" y="208.1631">{&lt;10s := HealthState_VZD=gesund}</text><line style="stroke:#000000;stroke-width:1.0;" x1="640" x2="682" y1="270.6641" y2="270.6641"/><line style="stroke:#000000;stroke-width:1.0;" x1="682" x2="682" y1="270.6641" y2="283.6641"/><line style="stroke:#000000;stroke-width:1.0;" x1="641" x2="682" y1="283.6641" y2="283.6641"/><polygon fill="#000000" points="651,279.6641,641,283.6641,651,287.6641,647,283.6641" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="647" y="254.2373">2</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="134" x="660" y="243.5459">Credentials prüfen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="174" x="660" y="264.9287">(client_id, client_secret)</text><polygon fill="#000000" points="153,315.0469,143,319.0469,153,323.0469,149,319.0469" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="634" y1="319.0469" y2="319.0469"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="445" y="313.3115">3</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="170" x="458" y="313.3115">ti-provider-accesstoken</text><polygon fill="#000000" points="842,378.8125,852,382.8125,842,386.8125,846,382.8125" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="848" y1="382.8125" y2="382.8125"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="149" y="366.3857">4</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="391" x="162" y="355.6943">GET /ti-provider-authenticate(ti-provider-accesstoken)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="162" y="377.0771">{&lt;10s := HealthState_VZD=gesund}</text><line style="stroke:#000000;stroke-width:1.0;" x1="864" x2="906" y1="439.5781" y2="439.5781"/><line style="stroke:#000000;stroke-width:1.0;" x1="906" x2="906" y1="439.5781" y2="452.5781"/><line style="stroke:#000000;stroke-width:1.0;" x1="865" x2="906" y1="452.5781" y2="452.5781"/><polygon fill="#000000" points="875,448.5781,865,452.5781,875,456.5781,871,452.5781" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="871" y="423.1514">5</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="96" x="884" y="412.46">Token prüfen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="182" x="884" y="433.8428">(ti-provider-accesstoken)</text><polygon fill="#000000" points="153,483.9609,143,487.9609,153,491.9609,149,487.9609" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="858" y1="487.9609" y2="487.9609"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="683" y="482.2256">6</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="156" x="696" y="482.2256">provider-accesstoken</text><polygon fill="#000000" points="1066,594.1094,1076,598.1094,1066,602.1094,1070,598.1094" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="1072" y1="598.1094" y2="598.1094"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="149" y="570.9912">7</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="432" x="162" y="549.6084">GET /tim-provider-services/FederationList/federationList.jws</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="285" x="162" y="570.9912">(provider-accesstoken, FLVersion_RD)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="162" y="592.374">{&lt;10s := HealthState_VZD=gesund}</text><line style="stroke:#000000;stroke-width:1.0;" x1="1088" x2="1130" y1="654.875" y2="654.875"/><line style="stroke:#000000;stroke-width:1.0;" x1="1130" x2="1130" y1="654.875" y2="667.875"/><line style="stroke:#000000;stroke-width:1.0;" x1="1089" x2="1130" y1="667.875" y2="667.875"/><polygon fill="#000000" points="1099,663.875,1089,667.875,1099,671.875,1095,667.875" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1095" y="638.4482">8</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="96" x="1108" y="627.7568">Token prüfen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="168" x="1108" y="649.1396">(provider-accesstoken)</text><path d="M20,682.875 L101,682.875 L101,691.2266 L91,701.2266 L20,701.2266 L20,682.875 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="123.0078" style="stroke:#000000;stroke-width:1.5;" width="1180" x="20" y="682.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="36" x="35" y="697.3701">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="116" y="702.583">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="305" x="120" y="701.4844">Abruf der Föderationsliste nicht möglich</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="425" y="702.583">]</text><polygon fill="#000000" points="153,793.8828,143,797.8828,153,801.8828,149,797.8828" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="1077" y1="797.8828" y2="797.8828"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="788" y="760.0732">9</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="262" x="801" y="727.999">ResponseType=Bad Request ODER</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="265" x="801" y="749.3818">ResponseType=Unauthorized ODER</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="243" x="801" y="770.7646">ResponseType=Forbidden ODER</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="193" x="801" y="792.1475">ResponseType=Not Found</text><line style="stroke:#000000;stroke-width:1.0;" x1="1088" x2="1130" y1="908.0313" y2="908.0313"/><line style="stroke:#000000;stroke-width:1.0;" x1="1130" x2="1130" y1="908.0313" y2="921.0313"/><line style="stroke:#000000;stroke-width:1.0;" x1="1089" x2="1130" y1="921.0313" y2="921.0313"/><polygon fill="#000000" points="1099,917.0313,1089,921.0313,1099,925.0313,1095,921.0313" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1095" y="880.9131">10</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="171" x="1117" y="859.5303">Auf neuere Version der</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="1117" y="880.9131">Föderationsliste prüfen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="119" x="1117" y="902.2959">(FLVersion_RD)</text><path d="M20,961.0313 L81,961.0313 L81,969.3828 L71,979.3828 L20,979.3828 L20,961.0313 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="359.8984" style="stroke:#000000;stroke-width:1.5;" width="1180" x="20" y="961.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="975.5264">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="96" y="980.7393">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="404" x="100" y="979.6406">keine neuere Version der Föderationsliste vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="504" y="980.7393">]</text><polygon fill="#000000" points="153,1007.8906,143,1011.8906,153,1015.8906,149,1011.8906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="1077" y1="1011.8906" y2="1011.8906"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="850" y="1006.1553">11</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="199" x="872" y="1006.1553">ResponseType=No Content</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="184" y1="1047.2734" y2="1047.2734"/><line style="stroke:#000000;stroke-width:1.0;" x1="184" x2="184" y1="1047.2734" y2="1060.2734"/><line style="stroke:#000000;stroke-width:1.0;" x1="143" x2="184" y1="1060.2734" y2="1060.2734"/><polygon fill="#000000" points="153,1056.2734,143,1060.2734,153,1064.2734,149,1060.2734" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="149" y="1041.5381">12</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="452" x="171" y="1041.5381">Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="1200" y1="1094.2734" y2="1094.2734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="25" y="1111.9814">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="579" x="29" y="1110.8828">neuere Version der Föderationsliste vorhanden ODER FLVersion_RD=NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="608" y="1111.9814">]</text><polygon fill="#000000" points="153,1138.7813,143,1142.7813,153,1146.7813,149,1142.7813" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="1082" y1="1142.7813" y2="1142.7813"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="801" y="1137.0459">13</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="253" x="823" y="1137.0459">Föderationsliste, x5c-Zertifikatsliste</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="189" y1="1173.1641" y2="1173.1641"/><line style="stroke:#000000;stroke-width:1.0;" x1="189" x2="189" y1="1173.1641" y2="1186.1641"/><line style="stroke:#000000;stroke-width:1.0;" x1="148" x2="189" y1="1186.1641" y2="1186.1641"/><polygon fill="#000000" points="158,1182.1641,148,1186.1641,158,1190.1641,154,1186.1641" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="154" y="1167.4287">14</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="336" x="176" y="1167.4287">Föderationsliste aktualisieren(Föderationsliste)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="189" y1="1231.5469" y2="1231.5469"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="189" x2="189" y1="1231.5469" y2="1244.5469"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="142" x2="189" y1="1244.5469" y2="1244.5469"/><polygon fill="#000000" points="152,1240.5469,142,1244.5469,152,1248.5469,148,1244.5469" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="154" y="1225.8115">15</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="176" y="1225.8115">Föderationsliste</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="184" y1="1274.9297" y2="1274.9297"/><line style="stroke:#000000;stroke-width:1.0;" x1="184" x2="184" y1="1274.9297" y2="1287.9297"/><line style="stroke:#000000;stroke-width:1.0;" x1="143" x2="184" y1="1287.9297" y2="1287.9297"/><polygon fill="#000000" points="153,1283.9297,143,1287.9297,153,1291.9297,149,1287.9297" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="149" y="1269.1943">16</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="452" x="171" y="1269.1943">Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)</text><!--MD5=[f4a8bef2bfd25a9143d4ccf359ba6572]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
}

autonumber

participant RD as "Registrierungs-Dienst"
box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
  participant Oauth as "OAuth-Service"
  participant AuthService as "Auth-Service"
  participant FP as "FHIR-Proxy"
end box

alt#LightGrey <size:16>kein gültiges provider-accesstoken vorhanden</size>
  activate RD
  alt#LightGrey <size:16>Benötigt IDP-TI-Provider-Accesstoken</size>
      RD -> Oauth: POST /auth/realms/TI-Provider/protocol/openid-connect/token\n(client_id, client_secret)\n{<10s := HealthState_VZD=gesund}
      activate Oauth
      Oauth -> Oauth: Credentials prüfen \n(client_id, client_secret)
      Oauth - -> RD: ti-provider-accesstoken
      deactivate Oauth
  end
  RD -> AuthService: GET /ti-provider-authenticate(ti-provider-accesstoken)\n{<10s := HealthState_VZD=gesund}
  activate AuthService
  AuthService -> AuthService: Token prüfen\n(ti-provider-accesstoken)
  AuthService - -> RD: provider-accesstoken
  deactivate AuthService
end

|||
RD->FP: GET /tim-provider-services/FederationList/federationList.jws\n(provider-accesstoken, FLVersion_RD)\n{<10s := HealthState_VZD=gesund}
  Activate FP
FP->FP: Token prüfen\n(provider-accesstoken)

break#LightGrey #LightPink <size:16>Abruf der Föderationsliste nicht möglich</size>
  FP- ->RD: ResponseType=Bad Request ODER \nResponseType=Unauthorized ODER \nResponseType=Forbidden ODER \nResponseType=Not Found
end 

|||
FP->FP: Auf neuere Version der \nFöderationsliste prüfen\n(FLVersion_RD)
|||

alt#LightGrey <size:16>keine neuere Version der Föderationsliste vorhanden</size>
  FP- ->RD: ResponseType=No Content
  RD->RD: Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)
  |||
else <size:16>neuere Version der Föderationsliste vorhanden ODER FLVersion_RD=NULL</size>
  FP- ->RD: Föderationsliste, x5c-Zertifikatsliste
      Deactivate FP
  RD->RD++: Föderationsliste aktualisieren(Föderationsliste)
  return Föderationsliste
  RD->RD: Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)
  |||
end
|||
@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: de
Country: DE
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2228px" preserveAspectRatio="none" style="width:1597px;height:2228px;background:#FFFFFF;" version="1.1" viewBox="0 0 1597 2228" width="1597px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2216.7422" style="stroke:#181818;stroke-width:0.5;" width="446" x="220" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="93" x="394" y="22.708">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="487" y="23.8872"> </text><rect fill="#F5F5F5" height="2216.7422" style="stroke:#181818;stroke-width:0.5;" width="681" x="894" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1132" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1332" y="23.8872"> </text><rect fill="#DCDCDC" height="1731.1953" style="stroke:#000000;stroke-width:1.0;" width="10" x="326" y="306.9844"/><rect fill="#DCDCDC" height="134.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="550" y="706.6328"/><rect fill="#DCDCDC" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="706.6328"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="1011.9453"/><rect fill="#DCDCDC" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="1453.5078"/><rect fill="#DCDCDC" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="1804.4453"/><rect fill="#DCDCDC" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1224" y="504.8984"/><rect fill="#DCDCDC" height="284.5234" style="stroke:#000000;stroke-width:1.0;" width="10" x="1224" y="933.3672"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="1553.875"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="1904.8125"/><rect fill="#F0F8FF" height="817.5391" style="stroke:#000000;stroke-width:1.5;" width="1454" x="10" y="433.3516"/><rect height="781.2891" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1581" x="10" y="1289.8906"/><rect height="311.9375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1367" x="214" y="1342.5156"/><rect height="311.9375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1367" x="214" y="1693.4531"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="116" x2="116" y1="111.5625" y2="2113.1797"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="331" x2="331" y1="111.5625" y2="2113.1797"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="555" x2="555" y1="111.5625" y2="2113.1797"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="780" x2="780" y1="111.5625" y2="2113.1797"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1005" x2="1005" y1="111.5625" y2="2113.1797"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1229" x2="1229" y1="111.5625" y2="2113.1797"/><line style="stroke:#000000;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1464" x2="1464" y1="111.5625" y2="2113.1797"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="83.5645">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="95" x="66" y="106.8457">User-HBA</text><ellipse cx="116.5" cy="13.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M116.5,21.5 L116.5,48.5 M103.5,29.5 L129.5,29.5 M116.5,48.5 L103.5,63.5 M116.5,48.5 L129.5,63.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="2130.7441">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="95" x="66" y="2154.0254">User-HBA</text><ellipse cx="116.5" cy="2167.2422" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M116.5,2175.2422 L116.5,2202.2422 M103.5,2183.2422 L129.5,2183.2422 M116.5,2202.2422 L103.5,2217.2422 M116.5,2202.2422 L129.5,2217.2422 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="224" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="98.8457">TI-Messenger-Client</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="224" y="2112.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="2137.7441">TI-Messenger-Client</text><rect fill="#EFEFFF" height="60.5625" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="448" y="50"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="483" y="75.5645">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="482.5" y="98.8457">des IDP-Dienst</text><rect fill="#EFEFFF" height="60.5625" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="448" y="2112.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="483" y="2137.7441">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="482.5" y="2161.0254">des IDP-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="673" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="728" y="98.8457">IDP-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="673" y="2112.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="728" y="2137.7441">IDP-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="898" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="951" y="98.8457">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="898" y="2112.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="951" y="2137.7441">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1122" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1165" y="98.8457">Auth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1122" y="2112.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1165" y="2137.7441">Auth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1357" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1391.5" y="98.8457">FHIR-Directory</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1357" y="2112.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1391.5" y="2137.7441">FHIR-Directory</text><rect fill="#DCDCDC" height="1731.1953" style="stroke:#000000;stroke-width:1.0;" width="10" x="326" y="306.9844"/><rect fill="#DCDCDC" height="134.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="550" y="706.6328"/><rect fill="#DCDCDC" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="706.6328"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="775" y="1011.9453"/><rect fill="#DCDCDC" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="1453.5078"/><rect fill="#DCDCDC" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1000" y="1804.4453"/><rect fill="#DCDCDC" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1224" y="504.8984"/><rect fill="#DCDCDC" height="284.5234" style="stroke:#000000;stroke-width:1.0;" width="10" x="1224" y="933.3672"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="1553.875"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1459" y="1904.8125"/><path d="M17,151.5625 L17,211.5625 L879,211.5625 L879,161.5625 L869,151.5625 L17,151.5625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M869,151.5625 L869,161.5625 L879,161.5625 L869,151.5625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="132.5" y="168.6294"> </text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="622" x="132.5" y="187.4751">Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="132.5" y="203.5513"> </text><polygon fill="#000000" points="314,302.9844,324,306.9844,314,310.9844,318,306.9844" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="320" y1="306.9844" y2="306.9844"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="168" x="123.5" y="261.397">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="123.5" y="281.186">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="123.5" y="300.9751">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="378" y1="380.3516" y2="380.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="378" x2="378" y1="380.3516" y2="393.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="337" x2="378" y1="393.3516" y2="393.3516"/><polygon fill="#000000" points="347,389.3516,337,393.3516,347,397.3516,343,393.3516" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="167" x="343" y="334.7642">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="343" y="354.5532">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="64" x="343" y="374.3423">vorliegt</text><path d="M10,433.3516 L74,433.3516 L74,440.4844 L64,450.4844 L10,450.4844 L10,433.3516 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="817.5391" style="stroke:#000000;stroke-width:1.5;" width="1454" x="10" y="433.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="446.4185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="89" y="451.3823">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="305" x="94" y="450.2031">kein gültigess owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="399" y="451.3823">]</text><polygon fill="#000000" points="1212,500.8984,1222,504.8984,1212,508.8984,1216,504.8984" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="1218" y1="504.8984" y2="504.8984"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="343" y="498.8892">GET /owner-authenticate</text><line style="stroke:#000000;stroke-width:1.0;" x1="1234" x2="1276" y1="558.4766" y2="558.4766"/><line style="stroke:#000000;stroke-width:1.0;" x1="1276" x2="1276" y1="558.4766" y2="571.4766"/><line style="stroke:#000000;stroke-width:1.0;" x1="1235" x2="1276" y1="571.4766" y2="571.4766"/><polygon fill="#000000" points="1245,567.4766,1235,571.4766,1245,575.4766,1241,571.4766" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="164" x="1241" y="532.6782">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="1241" y="552.4673">für verifier und challenge</text><polygon fill="#000000" points="347,601.2656,337,605.2656,347,609.2656,343,605.2656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1228" y1="605.2656" y2="605.2656"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="424" x="798" y="599.2563">Redirct to IDP Authorization Endpoint (PKCE Code)</text><polygon fill="#000000" points="127.5,635.0547,117.5,639.0547,127.5,643.0547,123.5,639.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="121.5" x2="325" y1="639.0547" y2="639.0547"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="184" x="135" y="633.0454">Liste verfügbarer IDPs</text><polygon fill="#000000" points="314,668.8438,324,672.8438,314,676.8438,318,672.8438" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="320" y1="672.8438" y2="672.8438"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="123.5" y="666.8345">ausgewählter IDP</text><polygon fill="#000000" points="763,702.6328,773,706.6328,763,710.6328,767,706.6328" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="769" y1="706.6328" y2="706.6328"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="343" y="700.6235">GET /authorize</text><polygon fill="#000000" points="347,736.4219,337,740.4219,347,744.4219,343,740.4219" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="774" y1="740.4219" y2="740.4219"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="209" x="559" y="734.4126">Authentication challenge</text><line style="stroke:#000000;stroke-width:1.0;" x1="560" x2="602" y1="774.2109" y2="774.2109"/><line style="stroke:#000000;stroke-width:1.0;" x1="602" x2="602" y1="774.2109" y2="787.2109"/><line style="stroke:#000000;stroke-width:1.0;" x1="561" x2="602" y1="787.2109" y2="787.2109"/><polygon fill="#000000" points="571,783.2109,561,787.2109,571,791.2109,567,787.2109" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="567" y="768.2017">Authentication</text><polygon fill="#000000" points="763,836.7891,773,840.7891,763,844.7891,767,840.7891" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="555" x2="769" y1="840.7891" y2="840.7891"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="562" y="814.9907">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="562" y="834.7798">challenge response</text><polygon fill="#000000" points="347,870.5781,337,874.5781,347,878.5781,343,874.5781" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="779" y1="874.5781" y2="874.5781"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="405" x="368" y="868.5688">Authorization Response with Authorization Code</text><polygon fill="#000000" points="1212,929.3672,1222,933.3672,1212,937.3672,1216,933.3672" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="1218" y1="933.3672" y2="933.3672"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="573" x="343" y="927.3579">GET /signin-gematik-idp-dienst with Authorization code (PKCE Code)</text><polygon fill="#000000" points="796,1007.9453,786,1011.9453,796,1015.9453,792,1011.9453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="790" x2="1223" y1="1011.9453" y2="1011.9453"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="178" x="1039" y="986.147">POST /tokenEndpoint</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="169" x="1039" y="1005.936">(authorization code)</text><polygon fill="#000000" points="1212,1041.7344,1222,1045.7344,1212,1049.7344,1216,1045.7344" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="780" x2="1218" y1="1045.7344" y2="1045.7344"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="72" x="787" y="1039.7251">id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1234" x2="1276" y1="1079.5234" y2="1079.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1276" x2="1276" y1="1079.5234" y2="1092.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1235" x2="1276" y1="1092.5234" y2="1092.5234"/><polygon fill="#000000" points="1245,1088.5234,1235,1092.5234,1245,1096.5234,1241,1092.5234" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="121" x="1241" y="1073.5142">prüfe id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1234" x2="1276" y1="1171.1016" y2="1171.1016"/><line style="stroke:#000000;stroke-width:1.0;" x1="1276" x2="1276" y1="1171.1016" y2="1184.1016"/><line style="stroke:#000000;stroke-width:1.0;" x1="1235" x2="1276" y1="1184.1016" y2="1184.1016"/><polygon fill="#000000" points="1245,1180.1016,1235,1184.1016,1245,1188.1016,1241,1184.1016" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="66" x="1241" y="1145.3032">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1241" y="1165.0923">owner-accesstoken</text><polygon fill="#000000" points="347,1213.8906,337,1217.8906,347,1221.8906,343,1217.8906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1228" y1="1217.8906" y2="1217.8906"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1063" y="1211.8813">owner-accesstoken</text><path d="M10,1289.8906 L297,1289.8906 L297,1300.5156 L287,1310.5156 L10,1310.5156 L10,1289.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="781.2891" style="stroke:#000000;stroke-width:1.5;" width="1581" x="10" y="1289.8906"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="242" x="25" y="1305.7422">VZD-FHIR-Directory Eintrag</text><path d="M214,1342.5156 L464,1342.5156 L464,1353.1406 L454,1363.1406 L214,1363.1406 L214,1342.5156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="311.9375" style="stroke:#000000;stroke-width:1.5;" width="1367" x="214" y="1342.5156"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="205" x="229" y="1358.3672">FHIR-Ressourcen lesen</text><polygon fill="#000000" points="988,1449.5078,998,1453.5078,988,1457.5078,992,1453.5078" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="994" y1="1453.5078" y2="1453.5078"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="278" x="343" y="1407.9204">POST /owner/PractitionerRole/?...</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="333" x="343" y="1427.7095">Finde Datensatz für eigene TelematikID</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="343" y="1447.4985">Authorization Bearer owner-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1052" y1="1507.0859" y2="1507.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="1052" x2="1052" y1="1507.0859" y2="1520.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="1011" x2="1052" y1="1520.0859" y2="1520.0859"/><polygon fill="#000000" points="1021,1516.0859,1011,1520.0859,1021,1524.0859,1017,1520.0859" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1017" y="1481.2876">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1017" y="1501.0767">owner-accesstoken</text><polygon fill="#000000" points="1447,1549.875,1457,1553.875,1447,1557.875,1451,1553.875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1453" y1="1553.875" y2="1553.875"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1017" y="1547.8657">HTTPS Forward</text><polygon fill="#000000" points="1021,1583.6641,1011,1587.6641,1021,1591.6641,1017,1587.6641" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1015" x2="1463" y1="1587.6641" y2="1587.6641"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1325" y="1581.6548">result body json</text><polygon fill="#000000" points="347,1617.4531,337,1621.4531,347,1625.4531,343,1621.4531" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1004" y1="1621.4531" y2="1621.4531"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="866" y="1615.4438">result body json</text><path d="M214,1693.4531 L504,1693.4531 L504,1704.0781 L494,1714.0781 L214,1714.0781 L214,1693.4531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="311.9375" style="stroke:#000000;stroke-width:1.5;" width="1367" x="214" y="1693.4531"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="245" x="229" y="1709.3047">FHIR-Ressourcen schreiben</text><polygon fill="#000000" points="988,1800.4453,998,1804.4453,988,1808.4453,992,1804.4453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="336" x2="994" y1="1804.4453" y2="1804.4453"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="459" x="343" y="1758.8579">FHIR-Operationen um eigenen Datensatz zu verwalten</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="343" y="1778.647">Authorization Bearer owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="435" x="343" y="1798.436">(Optional: setze Flag für Sichtbarkeit des Endpoints)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1052" y1="1858.0234" y2="1858.0234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1052" x2="1052" y1="1858.0234" y2="1871.0234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1011" x2="1052" y1="1871.0234" y2="1871.0234"/><polygon fill="#000000" points="1021,1867.0234,1011,1871.0234,1021,1875.0234,1017,1871.0234" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1017" y="1832.2251">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1017" y="1852.0142">owner-accesstoken</text><polygon fill="#000000" points="1447,1900.8125,1457,1904.8125,1447,1908.8125,1451,1904.8125" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1010" x2="1453" y1="1904.8125" y2="1904.8125"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1017" y="1898.8032">HTTPS Forward</text><polygon fill="#000000" points="1021,1934.6016,1011,1938.6016,1021,1942.6016,1017,1938.6016" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1015" x2="1463" y1="1938.6016" y2="1938.6016"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1325" y="1932.5923">result body json</text><polygon fill="#000000" points="347,1968.3906,337,1972.3906,347,1976.3906,343,1972.3906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="341" x2="1004" y1="1972.3906" y2="1972.3906"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="866" y="1966.3813">result body json</text><polygon fill="#000000" points="127.5,2034.1797,117.5,2038.1797,127.5,2042.1797,123.5,2038.1797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="121.5" x2="330" y1="2038.1797" y2="2038.1797"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="54" x="270" y="2032.1704">Status</text><!--MD5=[9f7183c6d00c859bcb5a038be620ff87]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U as "Akteur in der Rolle\nUser-HBA"
    box <size:18>Endgerät</size> #WhiteSmoke
      participant C as "TI-Messenger-Client"
      participant A as "Authenticator \ndes IDP-Dienst"
    end box
    participant I as "IDP-Dienst" 
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant Auth as "Auth-Service"
      participant VZD as "FHIR-Directory"
    end box

|||
note over U, I: \n<size:17>Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</size>\n
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültigess owner-accesstoken</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: Redirct to IDP Authorization Endpoint (PKCE Code)
    Deactivate Auth

  C->U: Liste verfügbarer IDPs
  U->C: ausgewählter IDP
    
  C->I: GET /authorize
    Activate A
    Activate I
  I- ->C: Authentication challenge
  A->A: Authentication
  A->I: Authentication \nchallenge response
    Deactivate A
  I- ->C: Authorization Response with Authorization Code
    Deactivate I
       
  |||          
  C->Auth: GET /signin-gematik-idp-dienst with Authorization code (PKCE Code)
    Activate Auth
  |||
  Auth- ->I: POST /tokenEndpoint\n(authorization code)
    Activate I
  I->Auth: id_token
    Deactivate I
  Auth->Auth: prüfe id_token
  |||
  Auth->Auth: erzeuge \nowner-accesstoken
  Auth- ->C: owner-accesstoken
    Deactivate Auth
  |||
end
      
|||

group <size:16>VZD-FHIR-Directory Eintrag</size>
  |||
  group <size:16>FHIR-Ressourcen lesen</size>
  |||
  C->FP: POST /owner/PractitionerRole/?... \nFinde Datensatz für eigene TelematikID \nAuthorization Bearer owner-accesstoken
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
  |||
  end
    
  |||
  group <size:16>FHIR-Ressourcen schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten \nAuthorization Bearer owner-accesstoken \n(Optional: setze Flag für Sichtbarkeit des Endpoints)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
     
  |||
  end

  C- ->U: Status    
    Deactivate C
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2177px" preserveAspectRatio="none" style="width:2010px;height:2177px;background:#FFFFFF;" version="1.1" viewBox="0 0 2010 2177" width="2010px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2165.4277" style="stroke:#181818;stroke-width:0.5;" width="491.5" x="213" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="84" x="414.75" y="23.4023">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="498.75" y="24.457"> </text><rect fill="#F5F5F5" height="2165.4277" style="stroke:#181818;stroke-width:0.5;" width="748" x="1240.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="188" x="1518.5" y="23.4023">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1706.5" y="24.457"> </text><rect fill="#DCDCDC" height="1677.502" style="stroke:#000000;stroke-width:1.0;" width="10" x="319.5" y="308.8164"/><rect fill="#DCDCDC" height="258.1719" style="stroke:#000000;stroke-width:1.0;" width="10" x="588.5" y="643.1426"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="897.5" y="745.207"/><rect fill="#DCDCDC" height="170.1074" style="stroke:#000000;stroke-width:1.0;" width="10" x="1121.5" y="677.1641"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="1121.5" y="1019.3574"/><rect fill="#DCDCDC" height="169.1074" style="stroke:#000000;stroke-width:1.0;" width="10" x="1346.5" y="1418.1953"/><rect fill="#DCDCDC" height="169.1074" style="stroke:#000000;stroke-width:1.0;" width="10" x="1346.5" y="1751.1895"/><rect fill="#DCDCDC" height="101.0645" style="stroke:#000000;stroke-width:1.0;" width="10" x="1570.5" y="508.0566"/><rect fill="#DCDCDC" height="241.1289" style="stroke:#000000;stroke-width:1.0;" width="10" x="1570.5" y="960.3359"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="1872.5" y="1519.2598"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="1872.5" y="1852.2539"/><rect fill="#F0F8FF" height="798.584" style="stroke:#000000;stroke-width:1.5;" width="1670.5" x="207" y="435.8809"/><rect fill="none" height="745.8535" style="stroke:#000000;stroke-width:1.5;" width="1994.5" x="10" y="1273.4648"/><rect fill="none" height="293.9941" style="stroke:#000000;stroke-width:1.5;" width="1787.5" x="207" y="1326.3086"/><rect fill="none" height="293.9941" style="stroke:#000000;stroke-width:1.5;" width="1787.5" x="207" y="1659.3027"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="113" x2="113" y1="112.1094" y2="2061.3184"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="324" x2="324" y1="112.1094" y2="2061.3184"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="593.5" x2="593.5" y1="112.1094" y2="2061.3184"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="902.5" x2="902.5" y1="112.1094" y2="2061.3184"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1126.5" x2="1126.5" y1="112.1094" y2="2061.3184"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1351.5" x2="1351.5" y1="112.1094" y2="2061.3184"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1575.5" x2="1575.5" y1="112.1094" y2="2061.3184"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1877.5" x2="1877.5" y1="112.1094" y2="2061.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="180" x="20" y="84.3359">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="96" x="62" y="107.8906">User-HBA</text><ellipse cx="113" cy="13.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M113,21.5 L113,48.5 M100,29.5 L126,29.5 M113,48.5 L100,63.5 M113,48.5 L126,63.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="180" x="20" y="2079.6543">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="96" x="62" y="2103.209">User-HBA</text><ellipse cx="113" cy="2115.9277" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M113,2123.9277 L113,2150.9277 M100,2131.9277 L126,2131.9277 M113,2150.9277 L100,2165.9277 M113,2150.9277 L126,2165.9277 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="215" x="217" y="73.5547"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="201" x="224" y="99.8906">TI-Messenger-Client</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="215" x="217" y="2060.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="201" x="224" y="2086.6543">TI-Messenger-Client</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="486.5" y="73.5547"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="129" x="529" y="99.8906">Authenticator</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="486.5" y="2060.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="129" x="529" y="2086.6543">Authenticator</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="795.5" y="73.5547"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="99" x="853" y="99.8906">Konnektor</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="795.5" y="2060.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="99" x="853" y="2086.6543">Konnektor</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1019.5" y="73.5547"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="196" x="1028.5" y="99.8906">zentraler IDP-Dienst</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1019.5" y="2060.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="196" x="1028.5" y="2086.6543">zentraler IDP-Dienst</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1244.5" y="73.5547"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="110" x="1296.5" y="99.8906">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1244.5" y="2060.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="110" x="1296.5" y="2086.6543">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1468.5" y="73.5547"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="124" x="1513.5" y="99.8906">Auth-Service</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1468.5" y="2060.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="124" x="1513.5" y="2086.6543">Auth-Service</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1770.5" y="73.5547"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="144" x="1805.5" y="99.8906">FHIR-Directory</text><rect fill="#EFEFFF" height="37.5547" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1770.5" y="2060.3184"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="144" x="1805.5" y="2086.6543">FHIR-Directory</text><rect fill="#DCDCDC" height="1677.502" style="stroke:#000000;stroke-width:1.0;" width="10" x="319.5" y="308.8164"/><rect fill="#DCDCDC" height="258.1719" style="stroke:#000000;stroke-width:1.0;" width="10" x="588.5" y="643.1426"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="897.5" y="745.207"/><rect fill="#DCDCDC" height="170.1074" style="stroke:#000000;stroke-width:1.0;" width="10" x="1121.5" y="677.1641"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="1121.5" y="1019.3574"/><rect fill="#DCDCDC" height="169.1074" style="stroke:#000000;stroke-width:1.0;" width="10" x="1346.5" y="1418.1953"/><rect fill="#DCDCDC" height="169.1074" style="stroke:#000000;stroke-width:1.0;" width="10" x="1346.5" y="1751.1895"/><rect fill="#DCDCDC" height="101.0645" style="stroke:#000000;stroke-width:1.0;" width="10" x="1570.5" y="508.0566"/><rect fill="#DCDCDC" height="241.1289" style="stroke:#000000;stroke-width:1.0;" width="10" x="1570.5" y="960.3359"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="1872.5" y="1519.2598"/><rect fill="#DCDCDC" height="34.0215" style="stroke:#000000;stroke-width:1.0;" width="10" x="1872.5" y="1852.2539"/><path d="M15,152.1094 L15,212.1094 L1223,212.1094 L1223,162.1094 L1213,152.1094 L15,152.1094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1213,152.1094 L1213,162.1094 L1223,162.1094 L1213,152.1094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="311.75" y="169.6777"> </text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="606" x="311.75" y="188.8555">Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="311.75" y="205.0098"> </text><polygon fill="#000000" points="307.5,304.8164,317.5,308.8164,307.5,312.8164,311.5,308.8164" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="113" x2="313.5" y1="308.8164" y2="308.8164"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="120" y="283.209">1</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="163" x="135" y="263.1875">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="135" y="283.209">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="157" x="135" y="303.2305">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:1.0;" x1="329.5" x2="371.5" y1="382.8809" y2="382.8809"/><line style="stroke:#000000;stroke-width:1.0;" x1="371.5" x2="371.5" y1="382.8809" y2="395.8809"/><line style="stroke:#000000;stroke-width:1.0;" x1="330.5" x2="371.5" y1="395.8809" y2="395.8809"/><polygon fill="#000000" points="340.5,391.8809,330.5,395.8809,340.5,399.8809,336.5,395.8809" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="336.5" y="357.2734">2</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="169" x="351.5" y="337.252">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="351.5" y="357.2734">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="62" x="351.5" y="377.2949">vorliegt</text><path d="M207,435.8809 L269,435.8809 L269,443.1914 L259,453.1914 L207,453.1914 L207,435.8809 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="798.584" style="stroke:#000000;stroke-width:1.5;" width="1670.5" x="207" y="435.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="222" y="449.4492">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="284" y="454.4043">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="366" x="288" y="453.3496">kein gültiges owner-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="654" y="454.4043">]</text><polygon fill="#000000" points="1558.5,504.0566,1568.5,508.0566,1558.5,512.0566,1562.5,508.0566" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="329.5" x2="1564.5" y1="508.0566" y2="508.0566"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="336.5" y="502.4707">3</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="207" x="351.5" y="502.4707">GET /owner-authenticate</text><line style="stroke:#000000;stroke-width:1.0;" x1="1580.5" x2="1622.5" y1="562.0996" y2="562.0996"/><line style="stroke:#000000;stroke-width:1.0;" x1="1622.5" x2="1622.5" y1="562.0996" y2="575.0996"/><line style="stroke:#000000;stroke-width:1.0;" x1="1581.5" x2="1622.5" y1="575.0996" y2="575.0996"/><polygon fill="#000000" points="1591.5,571.0996,1581.5,575.0996,1591.5,579.0996,1587.5,575.0996" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="1587.5" y="546.5029">4</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1602.5" y="536.4922">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="208" x="1602.5" y="556.5137">für verifier und challenge</text><polygon fill="#000000" points="340.5,605.1211,330.5,609.1211,340.5,613.1211,336.5,609.1211" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="334.5" x2="1574.5" y1="609.1211" y2="609.1211"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="1150.5" y="603.5352">5</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="403" x="1165.5" y="603.5352">HTTP 302 Redirect to IDP Authorization Endpoint</text><polygon fill="#000000" points="576.5,639.1426,586.5,643.1426,576.5,647.1426,580.5,643.1426" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="329.5" x2="582.5" y1="643.1426" y2="643.1426"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="336.5" y="637.5566">6</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="225" x="351.5" y="637.5566">Deeplink authenticator://...</text><polygon fill="#000000" points="1109.5,673.1641,1119.5,677.1641,1109.5,681.1641,1113.5,677.1641" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="598.5" x2="1115.5" y1="677.1641" y2="677.1641"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="605.5" y="671.5781">7</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="242" x="620.5" y="671.5781">GET {authorization_endpoint}</text><polygon fill="#000000" points="609.5,707.1855,599.5,711.1855,609.5,715.1855,605.5,711.1855" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603.5" x2="1120.5" y1="711.1855" y2="711.1855"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="894.5" y="705.5996">8</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="205" x="909.5" y="705.5996">Authentication challenge</text><polygon fill="#000000" points="885.5,741.207,895.5,745.207,885.5,749.207,889.5,745.207" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="598.5" x2="891.5" y1="745.207" y2="745.207"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="11" x="605.5" y="739.6211">9</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="170" x="620.5" y="739.6211">ExternalAuthenticate</text><polygon fill="#000000" points="609.5,775.2285,599.5,779.2285,609.5,783.2285,605.5,779.2285" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603.5" x2="901.5" y1="779.2285" y2="779.2285"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="620.5" y="773.6426">10</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="249" x="646.5" y="773.6426">ExternalAuthenticateResponse</text><polygon fill="#000000" points="1109.5,809.25,1119.5,813.25,1109.5,817.25,1113.5,813.25" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="598.5" x2="1115.5" y1="813.25" y2="813.25"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="605.5" y="807.6641">11</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="285" x="631.5" y="807.6641">Authentication challenge response</text><polygon fill="#000000" points="609.5,843.2715,599.5,847.2715,609.5,851.2715,605.5,847.2715" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="603.5" x2="1125.5" y1="847.2715" y2="847.2715"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="843.5" y="841.6855">12</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="250" x="869.5" y="841.6855">HTTP 302 Redirect(auth_code)</text><polygon fill="#000000" points="340.5,897.3145,330.5,901.3145,340.5,905.3145,336.5,901.3145" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="334.5" x2="592.5" y1="901.3145" y2="901.3145"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="395.5" y="885.7178">13</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="165" x="421.5" y="875.707">{client_callback_uri}</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="164" x="421.5" y="895.7285">Redirect(auth_code)</text><polygon fill="#000000" points="1558.5,956.3359,1568.5,960.3359,1558.5,964.3359,1562.5,960.3359" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="329.5" x2="1564.5" y1="960.3359" y2="960.3359"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="336.5" y="954.75">14</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="369" x="362.5" y="954.75">GET /signin-gematik-idp-dienst(auth_code)</text><polygon fill="#000000" points="1142.5,1015.3574,1132.5,1019.3574,1142.5,1023.3574,1138.5,1019.3574" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1136.5" x2="1569.5" y1="1019.3574" y2="1019.3574"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1185.5" y="1013.7715">15</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="352" x="1211.5" y="1013.7715">POST {token_endpoint}(auth_code, verifier)</text><polygon fill="#000000" points="1558.5,1049.3789,1568.5,1053.3789,1558.5,1057.3789,1562.5,1053.3789" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1126.5" x2="1564.5" y1="1053.3789" y2="1053.3789"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1133.5" y="1047.793">16</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="71" x="1159.5" y="1047.793">id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1580.5" x2="1622.5" y1="1087.4004" y2="1087.4004"/><line style="stroke:#000000;stroke-width:1.0;" x1="1622.5" x2="1622.5" y1="1087.4004" y2="1100.4004"/><line style="stroke:#000000;stroke-width:1.0;" x1="1581.5" x2="1622.5" y1="1100.4004" y2="1100.4004"/><polygon fill="#000000" points="1591.5,1096.4004,1581.5,1100.4004,1591.5,1104.4004,1587.5,1100.4004" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1587.5" y="1081.8145">17</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="252" x="1613.5" y="1081.8145">ID_TOKEN validieren(id_token)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1580.5" x2="1622.5" y1="1154.4434" y2="1154.4434"/><line style="stroke:#000000;stroke-width:1.0;" x1="1622.5" x2="1622.5" y1="1154.4434" y2="1167.4434"/><line style="stroke:#000000;stroke-width:1.0;" x1="1581.5" x2="1622.5" y1="1167.4434" y2="1167.4434"/><polygon fill="#000000" points="1591.5,1163.4434,1581.5,1167.4434,1591.5,1171.4434,1587.5,1167.4434" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1587.5" y="1138.8467">18</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="66" x="1613.5" y="1128.8359">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="243" x="1613.5" y="1148.8574">owner-accesstoken(id_token)</text><polygon fill="#000000" points="340.5,1197.4648,330.5,1201.4648,340.5,1205.4648,336.5,1201.4648" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="334.5" x2="1574.5" y1="1201.4648" y2="1201.4648"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1382.5" y="1195.8789">19</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="1408.5" y="1195.8789">owner-accesstoken</text><path d="M10,1273.4648 L285,1273.4648 L285,1284.3086 L275,1294.3086 L10,1294.3086 L10,1273.4648 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="745.8535" style="stroke:#000000;stroke-width:1.5;" width="1994.5" x="10" y="1273.4648"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="230" x="25" y="1289.9336">VZD-FHIR-Directory Eintrag</text><path d="M207,1326.3086 L442,1326.3086 L442,1337.1523 L432,1347.1523 L207,1347.1523 L207,1326.3086 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="293.9941" style="stroke:#000000;stroke-width:1.5;" width="1787.5" x="207" y="1326.3086"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="190" x="222" y="1342.7773">FHIR-Ressourcen lesen</text><polygon fill="#000000" points="1334.5,1414.1953,1344.5,1418.1953,1334.5,1422.1953,1338.5,1418.1953" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="329.5" x2="1340.5" y1="1418.1953" y2="1418.1953"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="336.5" y="1402.5986">20</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="264" x="362.5" y="1392.5879">GET /owner/PractitionerRole/?...</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="495" x="362.5" y="1412.6094">Finde Datensatz für eigene TelematikID(owner-accesstoken)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1356.5" x2="1398.5" y1="1472.2383" y2="1472.2383"/><line style="stroke:#000000;stroke-width:1.0;" x1="1398.5" x2="1398.5" y1="1472.2383" y2="1485.2383"/><line style="stroke:#000000;stroke-width:1.0;" x1="1357.5" x2="1398.5" y1="1485.2383" y2="1485.2383"/><polygon fill="#000000" points="1367.5,1481.2383,1357.5,1485.2383,1367.5,1489.2383,1363.5,1485.2383" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1363.5" y="1456.6416">21</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1389.5" y="1446.6309">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="1389.5" y="1466.6523">owner-accesstoken</text><polygon fill="#000000" points="1860.5,1515.2598,1870.5,1519.2598,1860.5,1523.2598,1864.5,1519.2598" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1356.5" x2="1866.5" y1="1519.2598" y2="1519.2598"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1363.5" y="1513.6738">22</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="123" x="1389.5" y="1513.6738">HTTPS Forward</text><polygon fill="#000000" points="1367.5,1549.2813,1357.5,1553.2813,1367.5,1557.2813,1363.5,1553.2813" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1361.5" x2="1876.5" y1="1553.2813" y2="1553.2813"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1711.5" y="1547.6953">23</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="133" x="1737.5" y="1547.6953">result body json</text><polygon fill="#000000" points="340.5,1583.3027,330.5,1587.3027,340.5,1591.3027,336.5,1587.3027" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="334.5" x2="1350.5" y1="1587.3027" y2="1587.3027"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1185.5" y="1581.7168">24</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="133" x="1211.5" y="1581.7168">result body json</text><path d="M207,1659.3027 L480,1659.3027 L480,1670.1465 L470,1680.1465 L207,1680.1465 L207,1659.3027 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="293.9941" style="stroke:#000000;stroke-width:1.5;" width="1787.5" x="207" y="1659.3027"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="228" x="222" y="1675.7715">FHIR-Ressourcen schreiben</text><polygon fill="#000000" points="1334.5,1747.1895,1344.5,1751.1895,1334.5,1755.1895,1338.5,1751.1895" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="329.5" x2="1340.5" y1="1751.1895" y2="1751.1895"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="336.5" y="1735.5928">25</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="446" x="362.5" y="1725.582">FHIR-Operationen um eigenen Datensatz zu verwalten</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="469" x="362.5" y="1745.6035">(owner-accesstoken, Flag für Sichtbarkeit des Endpoints)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1356.5" x2="1398.5" y1="1805.2324" y2="1805.2324"/><line style="stroke:#000000;stroke-width:1.0;" x1="1398.5" x2="1398.5" y1="1805.2324" y2="1818.2324"/><line style="stroke:#000000;stroke-width:1.0;" x1="1357.5" x2="1398.5" y1="1818.2324" y2="1818.2324"/><polygon fill="#000000" points="1367.5,1814.2324,1357.5,1818.2324,1367.5,1822.2324,1363.5,1818.2324" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1363.5" y="1789.6357">26</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1389.5" y="1779.625">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="1389.5" y="1799.6465">owner-accesstoken</text><polygon fill="#000000" points="1860.5,1848.2539,1870.5,1852.2539,1860.5,1856.2539,1864.5,1852.2539" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1356.5" x2="1866.5" y1="1852.2539" y2="1852.2539"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1363.5" y="1846.668">27</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="123" x="1389.5" y="1846.668">HTTPS Forward</text><polygon fill="#000000" points="1367.5,1882.2754,1357.5,1886.2754,1367.5,1890.2754,1363.5,1886.2754" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1361.5" x2="1876.5" y1="1886.2754" y2="1886.2754"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1711.5" y="1880.6895">28</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="133" x="1737.5" y="1880.6895">result body json</text><polygon fill="#000000" points="340.5,1916.2969,330.5,1920.2969,340.5,1924.2969,336.5,1920.2969" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="334.5" x2="1350.5" y1="1920.2969" y2="1920.2969"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="1185.5" y="1914.7109">29</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="133" x="1211.5" y="1914.7109">result body json</text><polygon fill="#000000" points="124,1982.3184,114,1986.3184,124,1990.3184,120,1986.3184" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="118" x2="323.5" y1="1986.3184" y2="1986.3184"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="22" x="241.5" y="1980.7324">30</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="50" x="267.5" y="1980.7324">Status</text><!--MD5=[33bde815701f9a254ec9fb85196827ba]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
}

autonumber

actor U as "Akteur in der Rolle\nUser-HBA"
box <size:18>Endgerät</size> #WhiteSmoke
  participant C as "TI-Messenger-Client"
  participant A as "Authenticator"
end box
participant konnektor as "Konnektor"
participant I as "zentraler IDP-Dienst" 
box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
  participant FP as "FHIR-Proxy"
  participant Auth as "Auth-Service"
  participant VZD as "FHIR-Directory"
end box

|||
note over U, I: \n<size:17>Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</size>\n
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges owner-accesstoken vorhanden</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: HTTP 302 Redirect to IDP Authorization Endpoint
  Deactivate Auth

  C->A++: Deeplink authenticator://...
  A->I: GET {authorization_endpoint}
  Activate I

  I- ->A: Authentication challenge
  A->konnektor++: ExternalAuthenticate

  konnektor - -> A: ExternalAuthenticateResponse
  deactivate konnektor
  
  A->I: Authentication challenge response
  I- ->A: HTTP 302 Redirect(auth_code)
  Deactivate I
  A- ->C: {client_callback_uri}\nRedirect(auth_code)

    Deactivate A
       
  |||          
  C->Auth: GET /signin-gematik-idp-dienst(auth_code)
    Activate Auth
  |||
  Auth->I: POST {token_endpoint}(auth_code, verifier)
  Activate I
  return id_token
  Deactivate I
  Auth->Auth: ID_TOKEN validieren(id_token)
  Auth->Auth: erzeuge \nowner-accesstoken(id_token)
  Auth- ->C: owner-accesstoken
    Deactivate Auth
  |||
end
      
|||

group <size:16>VZD-FHIR-Directory Eintrag</size>
  |||
  group <size:16>FHIR-Ressourcen lesen</size>
  |||
  C->FP: GET /owner/PractitionerRole/?... \nFinde Datensatz für eigene TelematikID(owner-accesstoken)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
  |||
  end
    
  |||
  group <size:16>FHIR-Ressourcen schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten\n(owner-accesstoken, Flag für Sichtbarkeit des Endpoints)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
     
  |||
  end

  C- ->U: Status    
    Deactivate C
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: de
Country: DE
--></g></svg>
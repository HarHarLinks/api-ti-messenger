<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2141.8356px" preserveAspectRatio="none" style="width:2048px;height:2141px;background:#FFFFFF;" version="1.1" viewBox="0 0 2048 2141" width="2048.4965px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2130.3234" style="stroke:#181818;stroke-width:0.4964848484848485;" width="540.672" x="211.5025" y="5.9578"/><text fill="#000000" font-family="sans-serif" font-size="17.8735" font-weight="bold" lengthAdjust="spacing" textLength="83.4095" x="438.1479" y="23.2378">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="12.9086" font-weight="bold" lengthAdjust="spacing" textLength="3.9719" x="521.5573" y="24.2851"> </text><rect fill="#F5F5F5" height="2130.3234" style="stroke:#181818;stroke-width:0.4964848484848485;" width="742.7413" x="1284.4063" y="5.9578"/><text fill="#000000" font-family="sans-serif" font-size="17.8735" font-weight="bold" lengthAdjust="spacing" textLength="186.6783" x="1560.4519" y="23.2378">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="12.9086" font-weight="bold" lengthAdjust="spacing" textLength="3.9719" x="1747.1302" y="24.2851"> </text><rect fill="#DCDCDC" height="1645.8279" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="317.2538" y="306.6453"/><rect fill="#DCDCDC" height="236.4761" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="636.9901" y="638.6211"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="943.8177" y="739.968"/><rect fill="#DCDCDC" height="168.9115" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1166.2429" y="672.4034"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1166.2429" y="992.3103"/><rect fill="#DCDCDC" height="167.9185" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1389.6611" y="1388.3442"/><rect fill="#DCDCDC" height="167.9185" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1389.6611" y="1718.9973"/><rect fill="#DCDCDC" height="100.3539" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1612.0863" y="504.4848"/><rect fill="#DCDCDC" height="239.4337" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1612.0863" y="933.7038"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1911.9632" y="1488.6982"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1911.9632" y="1819.3513"/><rect fill="#F0F8FF" height="773.089" style="stroke:#000000;stroke-width:1.4894545454545454;" width="1711.3833" x="205.5447" y="432.8165"/><rect fill="none" height="740.6099" style="stroke:#000000;stroke-width:1.4894545454545454;" width="2033.1055" x="9.9297" y="1244.6313"/><rect fill="none" height="291.9273" style="stroke:#000000;stroke-width:1.4894545454545454;" width="1827.5607" x="205.5447" y="1297.1035"/><rect fill="none" height="291.9273" style="stroke:#000000;stroke-width:1.4894545454545454;" width="1827.5607" x="205.5447" y="1627.7566"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="112.2056" x2="112.2056" y1="111.3212" y2="2026.9459"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="321.7222" x2="321.7222" y1="111.3212" y2="2026.9459"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="641.9549" x2="641.9549" y1="111.3212" y2="2026.9459"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="948.7825" x2="948.7825" y1="111.3212" y2="2026.9459"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="1171.2078" x2="1171.2078" y1="111.3212" y2="2026.9459"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="1394.6259" x2="1394.6259" y1="111.3212" y2="2026.9459"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="1617.0512" x2="1617.0512" y1="111.3212" y2="2026.9459"/><line style="stroke:#000000;stroke-width:0.4964848484848485;stroke-dasharray:5.0,5.0;" x1="1916.928" x2="1916.928" y1="111.3212" y2="2026.9459"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="178.7345" x="19.8594" y="83.743">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="95.3251" x="61.5641" y="107.1321">User-HBA</text><ellipse cx="112.2056" cy="13.4051" fill="#DCDCDC" rx="7.9438" ry="7.9438" style="stroke:#000000;stroke-width:0.4964848484848485;"/><path d="M112.2056,21.3488 L112.2056,48.159 M99.297,29.2926 L125.1142,29.2926 M112.2056,48.159 L99.297,63.0536 M112.2056,48.159 L125.1142,63.0536 " fill="none" style="stroke:#000000;stroke-width:0.4964848484848485;"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="178.7345" x="19.8594" y="2045.153">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="95.3251" x="61.5641" y="2068.5421">User-HBA</text><ellipse cx="112.2056" cy="2081.1714" fill="#DCDCDC" rx="7.9438" ry="7.9438" style="stroke:#000000;stroke-width:0.4964848484848485;"/><path d="M112.2056,2089.1152 L112.2056,2115.9253 M99.297,2097.0589 L125.1142,2097.0589 M112.2056,2115.9253 L99.297,2130.8199 M112.2056,2115.9253 L125.1142,2130.8199 " fill="none" style="stroke:#000000;stroke-width:0.4964848484848485;"/><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="213.4885" x="215.4744" y="73.0376"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="199.5869" x="222.4252" y="99.1884">TI-Messenger-Client</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="213.4885" x="215.4744" y="2025.953"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="199.5869" x="222.4252" y="2052.1038">TI-Messenger-Client</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="535.7072" y="73.0376"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="128.0931" x="577.9084" y="99.1884">Authenticator</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="535.7072" y="2025.953"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="128.0931" x="577.9084" y="2052.1038">Authenticator</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="842.5348" y="73.0376"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="98.304" x="899.6305" y="99.1884">Konnektor</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="842.5348" y="2025.953"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="98.304" x="899.6305" y="2052.1038">Konnektor</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1064.96" y="73.0376"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="194.6221" x="1073.8967" y="99.1884">zentraler IDP-Dienst</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1064.96" y="2025.953"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="194.6221" x="1073.8967" y="2052.1038">zentraler IDP-Dienst</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1288.3782" y="73.0376"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="109.2267" x="1340.0126" y="99.1884">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1288.3782" y="2025.953"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="109.2267" x="1340.0126" y="2052.1038">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1510.8034" y="73.0376"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="123.1282" x="1555.487" y="99.1884">Auth-Service</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1510.8034" y="2025.953"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="123.1282" x="1555.487" y="2052.1038">Auth-Service</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1810.6802" y="73.0376"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="142.9876" x="1845.4342" y="99.1884">FHIR-Directory</text><rect fill="#EFEFFF" height="37.2907" rx="2.4824" ry="2.4824" style="stroke:#000000;stroke-width:0.4964848484848485;" width="212.4955" x="1810.6802" y="2025.953"/><text fill="#000000" font-family="sans-serif" font-size="19.8594" lengthAdjust="spacing" textLength="142.9876" x="1845.4342" y="2052.1038">FHIR-Directory</text><rect fill="#DCDCDC" height="1645.8279" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="317.2538" y="306.6453"/><rect fill="#DCDCDC" height="236.4761" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="636.9901" y="638.6211"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="943.8177" y="739.968"/><rect fill="#DCDCDC" height="168.9115" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1166.2429" y="672.4034"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1166.2429" y="992.3103"/><rect fill="#DCDCDC" height="167.9185" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1389.6611" y="1388.3442"/><rect fill="#DCDCDC" height="167.9185" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1389.6611" y="1718.9973"/><rect fill="#DCDCDC" height="100.3539" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1612.0863" y="504.4848"/><rect fill="#DCDCDC" height="239.4337" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1612.0863" y="933.7038"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1911.9632" y="1488.6982"/><rect fill="#DCDCDC" height="33.7823" style="stroke:#000000;stroke-width:0.992969696969697;" width="9.9297" x="1911.9632" y="1819.3513"/><path d="M14.8945,151.04 L14.8945,210.6182 L1267.0293,210.6182 L1267.0293,160.9697 L1257.0996,151.04 L14.8945,151.04 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4964848484848485;"/><path d="M1257.0996,151.04 L1257.0996,160.9697 L1267.0293,160.9697 L1257.0996,151.04 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.4964848484848485;"/><text fill="#000000" font-family="sans-serif" font-size="12.9086" lengthAdjust="spacing" textLength="3.9719" x="335.872" y="168.4848"> </text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="601.7396" x="335.872" y="187.5278">Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</text><text fill="#000000" font-family="sans-serif" font-size="12.9086" lengthAdjust="spacing" textLength="3.9719" x="335.872" y="203.5685"> </text><polygon fill="#000000" points="305.3382,302.6735,315.2679,306.6453,305.3382,310.6172,309.3101,306.6453" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="112.2056" x2="311.296" y1="306.6453" y2="306.6453"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="119.1564" y="281.2179">1</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="161.8541" x="134.0509" y="261.3372">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="164.833" x="134.0509" y="281.2179">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="155.8962" x="134.0509" y="301.0987">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="327.1835" x2="368.8882" y1="380.1891" y2="380.1891"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="368.8882" x2="368.8882" y1="380.1891" y2="393.0977"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="328.1765" x2="368.8882" y1="393.0977" y2="393.0977"/><polygon fill="#000000" points="338.1062,389.1258,328.1765,393.0977,338.1062,397.0696,334.1343,393.0977" style="stroke:#000000;stroke-width:0.992969696969697;"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="334.1343" y="354.7617">2</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="167.8119" x="349.0288" y="334.881">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="158.8752" x="349.0288" y="354.7617">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="61.5641" x="349.0288" y="374.6424">vorliegt</text><path d="M205.5447,432.8165 L267.1088,432.8165 L267.1088,440.0756 L257.1792,450.0053 L205.5447,450.0053 L205.5447,432.8165 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.4894545454545454;"/><rect fill="none" height="773.089" style="stroke:#000000;stroke-width:1.4894545454545454;" width="1711.3833" x="205.5447" y="432.8165"/><text fill="#000000" font-family="sans-serif" font-size="12.9086" font-weight="bold" lengthAdjust="spacing" textLength="16.8805" x="220.4393" y="446.2895">alt</text><text fill="#000000" font-family="sans-serif" font-size="10.9227" font-weight="bold" lengthAdjust="spacing" textLength="3.9719" x="282.0034" y="451.2097">[</text><text fill="#000000" font-family="sans-serif" font-size="15.8875" font-weight="bold" lengthAdjust="spacing" textLength="363.4269" x="285.9753" y="450.1624">kein gültiges owner-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="10.9227" font-weight="bold" lengthAdjust="spacing" textLength="3.9719" x="649.4022" y="451.2097">]</text><polygon fill="#000000" points="1600.1707,500.513,1610.1004,504.4848,1600.1707,508.4567,1604.1425,504.4848" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="327.1835" x2="1606.1285" y1="504.4848" y2="504.4848"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="334.1343" y="498.9382">3</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="205.5447" x="349.0288" y="498.9382">GET /owner-authenticate</text><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1622.016" x2="1663.7207" y1="558.1479" y2="558.1479"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1663.7207" x2="1663.7207" y1="558.1479" y2="571.0565"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1623.009" x2="1663.7207" y1="571.0565" y2="571.0565"/><polygon fill="#000000" points="1632.9387,567.0846,1623.009,571.0565,1632.9387,575.0284,1628.9668,571.0565" style="stroke:#000000;stroke-width:0.992969696969697;"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="1628.9668" y="542.6608">4</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="157.8822" x="1643.8613" y="532.7205">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="206.5377" x="1643.8613" y="552.6012">für verifier und challenge</text><polygon fill="#000000" points="338.1062,600.8669,328.1765,604.8388,338.1062,608.8107,334.1343,604.8388" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="332.1484" x2="1616.0582" y1="604.8388" y2="604.8388"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="1195.039" y="599.2921">5</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="400.1668" x="1209.9336" y="599.2921">HTTP 302 Redirect to IDP Authorization Endpoint</text><polygon fill="#000000" points="625.0744,634.6492,635.0041,638.6211,625.0744,642.593,629.0463,638.6211" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="327.1835" x2="631.0322" y1="638.6211" y2="638.6211"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="334.1343" y="633.0744">6</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="223.4182" x="349.0288" y="633.0744">Deeplink authenticator://...</text><polygon fill="#000000" points="1154.3273,668.4315,1164.257,672.4034,1154.3273,676.3753,1158.2992,672.4034" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="646.9198" x2="1160.2851" y1="672.4034" y2="672.4034"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="653.8705" y="666.8567">7</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="167.8119" x="668.7651" y="666.8567">GET {auth_endpoint}</text><polygon fill="#000000" points="657.8424,702.2138,647.9127,706.1857,657.8424,710.1576,653.8705,706.1857" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="651.8846" x2="1165.2499" y1="706.1857" y2="706.1857"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="940.8388" y="700.639">8</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="203.5588" x="955.7333" y="700.639">Authentication challenge</text><polygon fill="#000000" points="931.9021,735.9961,941.8318,739.968,931.9021,743.9399,935.8739,739.968" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="646.9198" x2="937.8599" y1="739.968" y2="739.968"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="10.9227" x="653.8705" y="734.4213">9</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="168.8048" x="668.7651" y="734.4213">ExternalAuthenticate</text><polygon fill="#000000" points="657.8424,769.7784,647.9127,773.7503,657.8424,777.7222,653.8705,773.7503" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="651.8846" x2="947.7896" y1="773.7503" y2="773.7503"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="668.7651" y="768.2036">10</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="247.2495" x="694.5823" y="768.2036">ExternalAuthenticateResponse</text><polygon fill="#000000" points="1154.3273,803.5607,1164.257,807.5326,1154.3273,811.5045,1158.2992,807.5326" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="646.9198" x2="1160.2851" y1="807.5326" y2="807.5326"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="653.8705" y="801.9859">11</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="282.9964" x="679.6878" y="801.9859">Authentication challenge response</text><polygon fill="#000000" points="657.8424,837.343,647.9127,841.3149,657.8424,845.2868,653.8705,841.3149" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="651.8846" x2="1170.2148" y1="841.3149" y2="841.3149"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="890.1973" y="835.7682">12</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="248.2424" x="916.0145" y="835.7682">HTTP 302 Redirect(auth_code)</text><polygon fill="#000000" points="338.1062,871.1253,328.1765,875.0972,338.1062,879.0691,334.1343,875.0972" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="332.1484" x2="640.9619" y1="875.0972" y2="875.0972"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="349.0288" y="869.5505">13</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="260.1581" x="374.8461" y="869.5505">{client_callback_uri}(auth_code)</text><polygon fill="#000000" points="1600.1707,929.7319,1610.1004,933.7038,1600.1707,937.6756,1604.1425,933.7038" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="327.1835" x2="1606.1285" y1="933.7038" y2="933.7038"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="334.1343" y="928.1571">14</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="366.4058" x="359.9515" y="928.1571">GET /signin-gematik-idp-dienst(auth_code)</text><polygon fill="#000000" points="1187.0953,988.3384,1177.1656,992.3103,1187.0953,996.2822,1183.1234,992.3103" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1181.1375" x2="1611.0933" y1="992.3103" y2="992.3103"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1238.7297" y="986.7636">15</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="340.5886" x="1264.5469" y="986.7636">POST {tokenEndpoint}(auth_code, verifier)</text><polygon fill="#000000" points="1600.1707,1022.1207,1610.1004,1026.0926,1600.1707,1030.0645,1604.1425,1026.0926" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="1171.2078" x2="1606.1285" y1="1026.0926" y2="1026.0926"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1178.1585" y="1020.5459">16</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="70.5008" x="1203.9758" y="1020.5459">id_token</text><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1622.016" x2="1663.7207" y1="1059.8749" y2="1059.8749"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1663.7207" x2="1663.7207" y1="1059.8749" y2="1072.7835"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1623.009" x2="1663.7207" y1="1072.7835" y2="1072.7835"/><polygon fill="#000000" points="1632.9387,1068.8116,1623.009,1072.7835,1632.9387,1076.7554,1628.9668,1072.7835" style="stroke:#000000;stroke-width:0.992969696969697;"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1628.9668" y="1054.3282">17</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="250.2284" x="1654.784" y="1054.3282">ID_TOKEN validieren(id_token)</text><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1622.016" x2="1663.7207" y1="1126.4465" y2="1126.4465"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1663.7207" x2="1663.7207" y1="1126.4465" y2="1139.3552"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1623.009" x2="1663.7207" y1="1139.3552" y2="1139.3552"/><polygon fill="#000000" points="1632.9387,1135.3833,1623.009,1139.3552,1632.9387,1143.327,1628.9668,1139.3552" style="stroke:#000000;stroke-width:0.992969696969697;"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1628.9668" y="1110.9595">18</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="65.536" x="1654.784" y="1101.0192">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="241.2916" x="1654.784" y="1120.8999">owner-accesstoken(id_token)</text><polygon fill="#000000" points="338.1062,1169.1656,328.1765,1173.1375,338.1062,1177.1093,334.1343,1173.1375" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="332.1484" x2="1616.0582" y1="1173.1375" y2="1173.1375"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1425.408" y="1167.5908">19</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="158.8752" x="1451.2252" y="1167.5908">owner-accesstoken</text><path d="M9.9297,1244.6313 L282.9964,1244.6313 L282.9964,1255.3988 L273.0667,1265.3285 L9.9297,1265.3285 L9.9297,1244.6313 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.4894545454545454;"/><rect fill="none" height="740.6099" style="stroke:#000000;stroke-width:1.4894545454545454;" width="2033.1055" x="9.9297" y="1244.6313"/><text fill="#000000" font-family="sans-serif" font-size="15.8875" font-weight="bold" lengthAdjust="spacing" textLength="228.383" x="24.8242" y="1260.9842">VZD-FHIR-Directory Eintrag</text><path d="M205.5447,1297.1035 L438.8926,1297.1035 L438.8926,1307.871 L428.9629,1317.8007 L205.5447,1317.8007 L205.5447,1297.1035 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.4894545454545454;"/><rect fill="none" height="291.9273" style="stroke:#000000;stroke-width:1.4894545454545454;" width="1827.5607" x="205.5447" y="1297.1035"/><text fill="#000000" font-family="sans-serif" font-size="15.8875" font-weight="bold" lengthAdjust="spacing" textLength="188.6642" x="220.4393" y="1313.4565">FHIR-Ressourcen lesen</text><polygon fill="#000000" points="1377.7455,1384.3724,1387.6752,1388.3442,1377.7455,1392.3161,1381.7173,1388.3442" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="327.1835" x2="1383.7033" y1="1388.3442" y2="1388.3442"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="334.1343" y="1372.8572">20</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="262.144" x="359.9515" y="1362.9168">GET /owner/PractitionerRole/?...</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="491.52" x="359.9515" y="1382.7976">Finde Datensatz für eigene TelematikID(owner-accesstoken)</text><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1399.5908" x2="1441.2955" y1="1442.0073" y2="1442.0073"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1441.2955" x2="1441.2955" y1="1442.0073" y2="1454.9159"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1400.5838" x2="1441.2955" y1="1454.9159" y2="1454.9159"/><polygon fill="#000000" points="1410.5135,1450.944,1400.5838,1454.9159,1410.5135,1458.8878,1406.5416,1454.9159" style="stroke:#000000;stroke-width:0.992969696969697;"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1406.5416" y="1426.5202">21</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="43.6907" x="1432.3588" y="1416.5799">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="158.8752" x="1432.3588" y="1436.4606">owner-accesstoken</text><polygon fill="#000000" points="1900.0475,1484.7263,1909.9772,1488.6982,1900.0475,1492.6701,1904.0194,1488.6982" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1399.5908" x2="1906.0053" y1="1488.6982" y2="1488.6982"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1406.5416" y="1483.1515">22</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="122.1353" x="1432.3588" y="1483.1515">HTTPS Forward</text><polygon fill="#000000" points="1410.5135,1518.5086,1400.5838,1522.4805,1410.5135,1526.4524,1406.5416,1522.4805" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="1404.5556" x2="1915.935" y1="1522.4805" y2="1522.4805"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1752.095" y="1516.9338">23</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="132.065" x="1777.9122" y="1516.9338">result body json</text><polygon fill="#000000" points="338.1062,1552.2909,328.1765,1556.2628,338.1062,1560.2347,334.1343,1556.2628" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="332.1484" x2="1393.633" y1="1556.2628" y2="1556.2628"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1229.793" y="1550.7161">24</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="132.065" x="1255.6102" y="1550.7161">result body json</text><path d="M205.5447,1627.7566 L476.6255,1627.7566 L476.6255,1638.5241 L466.6958,1648.4538 L205.5447,1648.4538 L205.5447,1627.7566 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.4894545454545454;"/><rect fill="none" height="291.9273" style="stroke:#000000;stroke-width:1.4894545454545454;" width="1827.5607" x="205.5447" y="1627.7566"/><text fill="#000000" font-family="sans-serif" font-size="15.8875" font-weight="bold" lengthAdjust="spacing" textLength="226.3971" x="220.4393" y="1644.1096">FHIR-Ressourcen schreiben</text><polygon fill="#000000" points="1377.7455,1715.0255,1387.6752,1718.9973,1377.7455,1722.9692,1381.7173,1718.9973" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="327.1835" x2="1383.7033" y1="1718.9973" y2="1718.9973"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="334.1343" y="1703.5103">25</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="442.8645" x="359.9515" y="1693.5699">FHIR-Operationen um eigenen Datensatz zu verwalten</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="465.7028" x="359.9515" y="1713.4507">(owner-accesstoken, Flag für Sichtbarkeit des Endpoints)</text><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1399.5908" x2="1441.2955" y1="1772.6604" y2="1772.6604"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1441.2955" x2="1441.2955" y1="1772.6604" y2="1785.569"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1400.5838" x2="1441.2955" y1="1785.569" y2="1785.569"/><polygon fill="#000000" points="1410.5135,1781.5971,1400.5838,1785.569,1410.5135,1789.5408,1406.5416,1785.569" style="stroke:#000000;stroke-width:0.992969696969697;"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1406.5416" y="1757.1733">26</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="43.6907" x="1432.3588" y="1747.233">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="158.8752" x="1432.3588" y="1767.1137">owner-accesstoken</text><polygon fill="#000000" points="1900.0475,1815.3794,1909.9772,1819.3513,1900.0475,1823.3232,1904.0194,1819.3513" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;" x1="1399.5908" x2="1906.0053" y1="1819.3513" y2="1819.3513"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1406.5416" y="1813.8046">27</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="122.1353" x="1432.3588" y="1813.8046">HTTPS Forward</text><polygon fill="#000000" points="1410.5135,1849.1617,1400.5838,1853.1336,1410.5135,1857.1055,1406.5416,1853.1336" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="1404.5556" x2="1915.935" y1="1853.1336" y2="1853.1336"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1752.095" y="1847.5869">28</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="132.065" x="1777.9122" y="1847.5869">result body json</text><polygon fill="#000000" points="338.1062,1882.944,328.1765,1886.9159,338.1062,1890.8878,334.1343,1886.9159" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="332.1484" x2="1393.633" y1="1886.9159" y2="1886.9159"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="1229.793" y="1881.3692">29</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="132.065" x="1255.6102" y="1881.3692">result body json</text><polygon fill="#000000" points="123.1282,1948.5013,113.1985,1952.4732,123.1282,1956.4451,119.1564,1952.4732" style="stroke:#000000;stroke-width:0.992969696969697;"/><line style="stroke:#000000;stroke-width:0.992969696969697;stroke-dasharray:2.0,2.0;" x1="117.1704" x2="321.2257" y1="1952.4732" y2="1952.4732"/><text fill="#000000" font-family="sans-serif" font-size="16.8805" font-weight="bold" lengthAdjust="spacing" textLength="21.8453" x="239.8022" y="1946.9265">30</text><text fill="#000000" font-family="sans-serif" font-size="16.8805" lengthAdjust="spacing" textLength="49.6485" x="265.6194" y="1946.9265">Status</text><!--MD5=[24a1e8f3eb376ea51ce1a4520913de49]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
}

autonumber

actor U as "Akteur in der Rolle\nUser-HBA"
box <size:18>Endgerät</size> #WhiteSmoke
  participant C as "TI-Messenger-Client"
  participant A as "Authenticator"
end box
participant konnektor as "Konnektor"
participant I as "zentraler IDP-Dienst" 
box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
  participant FP as "FHIR-Proxy"
  participant Auth as "Auth-Service"
  participant VZD as "FHIR-Directory"
end box

|||
note over U, I: \n<size:17>Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</size>\n
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges owner-accesstoken vorhanden</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: HTTP 302 Redirect to IDP Authorization Endpoint
  Deactivate Auth

  C->A++: Deeplink authenticator://...
  A->I: GET {auth_endpoint}
  Activate I

  I- ->A: Authentication challenge
  A->konnektor++: ExternalAuthenticate

  konnektor - -> A: ExternalAuthenticateResponse
  deactivate konnektor
  
  A->I: Authentication challenge response
  I- ->A: HTTP 302 Redirect(auth_code)
  Deactivate I
  A- ->C: {client_callback_uri}(auth_code)

    Deactivate A
       
  |||          
  C->Auth: GET /signin-gematik-idp-dienst(auth_code)
    Activate Auth
  |||
  Auth->I: POST {tokenEndpoint}(auth_code, verifier)
  Activate I
  return id_token
  Deactivate I
  Auth->Auth: ID_TOKEN validieren(id_token)
  Auth->Auth: erzeuge \nowner-accesstoken(id_token)
  Auth- ->C: owner-accesstoken
    Deactivate Auth
  |||
end
      
|||

group <size:16>VZD-FHIR-Directory Eintrag</size>
  |||
  group <size:16>FHIR-Ressourcen lesen</size>
  |||
  C->FP: GET /owner/PractitionerRole/?... \nFinde Datensatz für eigene TelematikID(owner-accesstoken)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
  |||
  end
    
  |||
  group <size:16>FHIR-Ressourcen schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten\n(owner-accesstoken, Flag für Sichtbarkeit des Endpoints)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
     
  |||
  end

  C- ->U: Status    
    Deactivate C
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: de
Country: DE
--></g></svg>
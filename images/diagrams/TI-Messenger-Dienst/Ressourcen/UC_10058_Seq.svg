<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2227px" preserveAspectRatio="none" style="width:1951px;height:2227px;background:#FFFFFF;" version="1.1" viewBox="0 0 1951 2227" width="1951px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2215.875" style="stroke:#181818;stroke-width:0.5;" width="512" x="195" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="79" x="409.5" y="24.6855">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="488.5" y="25.7842"> </text><rect fill="#F5F5F5" height="2215.875" style="stroke:#181818;stroke-width:0.5;" width="719" x="1210" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="171" x="1482" y="24.6855">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1653" y="25.7842"> </text><rect fill="#DCDCDC" height="1714.0156" style="stroke:#000000;stroke-width:1.0;" width="10" x="301" y="319.5469"/><rect fill="#DCDCDC" height="247.6797" style="stroke:#000000;stroke-width:1.0;" width="10" x="591" y="667.0859"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="867" y="773.2344"/><rect fill="#DCDCDC" height="176.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="1091" y="702.4688"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1091" y="1035.5313"/><rect fill="#DCDCDC" height="175.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="1316" y="1446.4609"/><rect fill="#DCDCDC" height="175.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="1316" y="1790.2656"/><rect fill="#DCDCDC" height="105.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="1540" y="526.5547"/><rect fill="#DCDCDC" height="249.2969" style="stroke:#000000;stroke-width:1.0;" width="10" x="1540" y="975.1484"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1813" y="1551.6094"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1813" y="1895.4141"/><rect fill="#F0F8FF" height="806.75" style="stroke:#000000;stroke-width:1.5;" width="1629" x="189" y="450.6953"/><rect fill="none" height="770.1172" style="stroke:#000000;stroke-width:1.5;" width="1935" x="10" y="1296.4453"/><rect fill="none" height="304.8047" style="stroke:#000000;stroke-width:1.5;" width="1746" x="189" y="1350.5703"/><rect fill="none" height="304.8047" style="stroke:#000000;stroke-width:1.5;" width="1746" x="189" y="1694.375"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="104" x2="104" y1="115.3125" y2="2108.5625"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="306" x2="306" y1="115.3125" y2="2108.5625"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="596" x2="596" y1="115.3125" y2="2108.5625"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="872" x2="872" y1="115.3125" y2="2108.5625"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1096" x2="1096" y1="115.3125" y2="2108.5625"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1321" x2="1321" y1="115.3125" y2="2108.5625"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1545" x2="1545" y1="115.3125" y2="2108.5625"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1818" x2="1818" y1="115.3125" y2="2108.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="20" y="85.7617">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="87" x="57.5" y="110.918">User-HBA</text><ellipse cx="104" cy="13.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M104,21.5 L104,48.5 M91,29.5 L117,29.5 M104,48.5 L91,63.5 M104,48.5 L117,63.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="20" y="2128.3242">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="87" x="57.5" y="2153.4805">User-HBA</text><ellipse cx="104" cy="2166.375" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M104,2174.375 L104,2201.375 M91,2182.375 L117,2182.375 M104,2201.375 L91,2216.375 M104,2201.375 L117,2216.375 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="199" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179" x="216.5" y="102.918">TI-Messenger-Client</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="199" y="2107.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179" x="216.5" y="2135.3242">TI-Messenger-Client</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="489" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="115" x="538.5" y="102.918">Authenticator</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="489" y="2107.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="115" x="538.5" y="2135.3242">Authenticator</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="765" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="89" x="827.5" y="102.918">Konnektor</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="765" y="2107.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="89" x="827.5" y="2135.3242">Konnektor</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="989" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="177" x="1007.5" y="102.918">zentraler IDP-Dienst</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="989" y="2107.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="177" x="1007.5" y="2135.3242">zentraler IDP-Dienst</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1214" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="1270" y="102.918">FHIR-Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1214" y="2107.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="1270" y="2135.3242">FHIR-Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1438" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="1489.5" y="102.918">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1438" y="2107.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="1489.5" y="2135.3242">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1711" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="132" x="1752" y="102.918">FHIR-Directory</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1711" y="2107.5625"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="132" x="1752" y="2135.3242">FHIR-Directory</text><rect fill="#DCDCDC" height="1714.0156" style="stroke:#000000;stroke-width:1.0;" width="10" x="301" y="319.5469"/><rect fill="#DCDCDC" height="247.6797" style="stroke:#000000;stroke-width:1.0;" width="10" x="591" y="667.0859"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="867" y="773.2344"/><rect fill="#DCDCDC" height="176.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="1091" y="702.4688"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1091" y="1035.5313"/><rect fill="#DCDCDC" height="175.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="1316" y="1446.4609"/><rect fill="#DCDCDC" height="175.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="1316" y="1790.2656"/><rect fill="#DCDCDC" height="105.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="1540" y="526.5547"/><rect fill="#DCDCDC" height="249.2969" style="stroke:#000000;stroke-width:1.0;" width="10" x="1540" y="975.1484"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1813" y="1551.6094"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1813" y="1895.4141"/><path d="M11,155.3125 L11,219.3125 L1189,219.3125 L1189,165.3125 L1179,155.3125 L11,155.3125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1179,155.3125 L1179,165.3125 L1189,165.3125 L1179,155.3125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="323" y="173.8076"> </text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="545" x="323" y="194.3115">Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="323" y="211.542"> </text><polygon fill="#000000" points="289,315.5469,299,319.5469,289,323.5469,293,319.5469" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="104" x2="295" y1="319.5469" y2="319.5469"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="111" y="292.4287">1</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="151" x="124" y="271.0459">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="149" x="124" y="292.4287">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="138" x="124" y="313.8115">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:1.0;" x1="311" x2="353" y1="397.6953" y2="397.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="353" x2="353" y1="397.6953" y2="410.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="312" x2="353" y1="410.6953" y2="410.6953"/><polygon fill="#000000" points="322,406.6953,312,410.6953,322,414.6953,318,410.6953" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="318" y="370.5771">2</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="146" x="331" y="349.1943">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="141" x="331" y="370.5771">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="331" y="391.96">vorliegt</text><path d="M189,450.6953 L250,450.6953 L250,459.0469 L240,469.0469 L189,469.0469 L189,450.6953 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="806.75" style="stroke:#000000;stroke-width:1.5;" width="1629" x="189" y="450.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="204" y="465.1904">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="265" y="470.4033">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="338" x="269" y="469.3047">kein gültiges owner-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="607" y="470.4033">]</text><polygon fill="#000000" points="1528,522.5547,1538,526.5547,1528,530.5547,1532,526.5547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="311" x2="1534" y1="526.5547" y2="526.5547"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="318" y="520.8193">3</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="180" x="331" y="520.8193">GET /owner-authenticate</text><line style="stroke:#000000;stroke-width:1.0;" x1="1550" x2="1592" y1="583.3203" y2="583.3203"/><line style="stroke:#000000;stroke-width:1.0;" x1="1592" x2="1592" y1="583.3203" y2="596.3203"/><line style="stroke:#000000;stroke-width:1.0;" x1="1551" x2="1592" y1="596.3203" y2="596.3203"/><polygon fill="#000000" points="1561,592.3203,1551,596.3203,1561,600.3203,1557,596.3203" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1557" y="566.8936">4</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="155" x="1570" y="556.2021">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="181" x="1570" y="577.585">für verifier und challenge</text><polygon fill="#000000" points="322,627.7031,312,631.7031,322,635.7031,318,631.7031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="316" x2="1544" y1="631.7031" y2="631.7031"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1167" y="625.9678">5</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="358" x="1180" y="625.9678">HTTP 302 Redirect to IDP Authorization Endpoint</text><polygon fill="#000000" points="579,663.0859,589,667.0859,579,671.0859,583,667.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="311" x2="585" y1="667.0859" y2="667.0859"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="318" y="661.3506">6</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="192" x="331" y="661.3506">Deeplink authenticator://...</text><polygon fill="#000000" points="1079,698.4688,1089,702.4688,1079,706.4688,1083,702.4688" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="601" x2="1085" y1="702.4688" y2="702.4688"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="608" y="696.7334">7</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="151" x="621" y="696.7334">GET {auth_endpoint}</text><polygon fill="#000000" points="612,733.8516,602,737.8516,612,741.8516,608,737.8516" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="606" x2="1090" y1="737.8516" y2="737.8516"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="894" y="732.1162">8</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="177" x="907" y="732.1162">Authentication challenge</text><polygon fill="#000000" points="855,769.2344,865,773.2344,855,777.2344,859,773.2344" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="601" x2="861" y1="773.2344" y2="773.2344"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="608" y="767.499">9</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="621" y="767.499">ExternalAuthenticate</text><polygon fill="#000000" points="612,804.6172,602,808.6172,612,812.6172,608,808.6172" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="606" x2="871" y1="808.6172" y2="808.6172"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="623" y="802.8818">10</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="220" x="645" y="802.8818">ExternalAuthenticateResponse</text><polygon fill="#000000" points="1079,840,1089,844,1079,848,1083,844" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="601" x2="1085" y1="844" y2="844"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="608" y="838.2646">11</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="249" x="630" y="838.2646">Authentication challenge response</text><polygon fill="#000000" points="612,875.3828,602,879.3828,612,883.3828,608,879.3828" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="606" x2="1095" y1="879.3828" y2="879.3828"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="841" y="873.6475">12</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="226" x="863" y="873.6475">HTTP 302 Redirect(auth_code)</text><polygon fill="#000000" points="322,910.7656,312,914.7656,322,918.7656,318,914.7656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="316" x2="595" y1="914.7656" y2="914.7656"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="333" y="909.0303">13</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="234" x="355" y="909.0303">{client_callback_uri}(auth_code)</text><polygon fill="#000000" points="1528,971.1484,1538,975.1484,1528,979.1484,1532,975.1484" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="311" x2="1534" y1="975.1484" y2="975.1484"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="318" y="969.4131">14</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="312" x="340" y="969.4131">GET /signin-gematik-idp-dienst(auth_code)</text><polygon fill="#000000" points="1112,1031.5313,1102,1035.5313,1112,1039.5313,1108,1035.5313" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1106" x2="1539" y1="1035.5313" y2="1035.5313"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1200" y="1029.7959">15</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="311" x="1222" y="1029.7959">POST {tokenEndpoint}(auth_code, verifier)</text><polygon fill="#000000" points="1528,1066.9141,1538,1070.9141,1528,1074.9141,1532,1070.9141" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1096" x2="1534" y1="1070.9141" y2="1070.9141"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1103" y="1065.1787">16</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="61" x="1125" y="1065.1787">id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1550" x2="1592" y1="1106.2969" y2="1106.2969"/><line style="stroke:#000000;stroke-width:1.0;" x1="1592" x2="1592" y1="1106.2969" y2="1119.2969"/><line style="stroke:#000000;stroke-width:1.0;" x1="1551" x2="1592" y1="1119.2969" y2="1119.2969"/><polygon fill="#000000" points="1561,1115.2969,1551,1119.2969,1561,1123.2969,1557,1119.2969" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1557" y="1100.5615">17</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="227" x="1579" y="1100.5615">ID_TOKEN validieren(id_token)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1550" x2="1592" y1="1176.0625" y2="1176.0625"/><line style="stroke:#000000;stroke-width:1.0;" x1="1592" x2="1592" y1="1176.0625" y2="1189.0625"/><line style="stroke:#000000;stroke-width:1.0;" x1="1551" x2="1592" y1="1189.0625" y2="1189.0625"/><polygon fill="#000000" points="1561,1185.0625,1551,1189.0625,1561,1193.0625,1557,1189.0625" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1557" y="1159.6357">18</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="59" x="1579" y="1148.9443">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="214" x="1579" y="1170.3271">owner-accesstoken(id_token)</text><polygon fill="#000000" points="322,1220.4453,312,1224.4453,322,1228.4453,318,1224.4453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="316" x2="1544" y1="1224.4453" y2="1224.4453"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1375" y="1218.71">19</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="141" x="1397" y="1218.71">owner-accesstoken</text><path d="M10,1296.4453 L264,1296.4453 L264,1308.5703 L254,1318.5703 L10,1318.5703 L10,1296.4453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="770.1172" style="stroke:#000000;stroke-width:1.5;" width="1935" x="10" y="1296.4453"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="209" x="25" y="1314.0547">VZD-FHIR-Directory Eintrag</text><path d="M189,1350.5703 L415,1350.5703 L415,1362.6953 L405,1372.6953 L189,1372.6953 L189,1350.5703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="304.8047" style="stroke:#000000;stroke-width:1.5;" width="1746" x="189" y="1350.5703"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="181" x="204" y="1368.1797">FHIR-Ressourcen lesen</text><polygon fill="#000000" points="1304,1442.4609,1314,1446.4609,1304,1450.4609,1308,1446.4609" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="311" x2="1310" y1="1446.4609" y2="1446.4609"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="318" y="1430.0342">20</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="247" x="340" y="1419.3428">POST /owner/PractitionerRole/?...</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="440" x="340" y="1440.7256">Finde Datensatz für eigene TelematikID(owner-accesstoken)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1326" x2="1368" y1="1503.2266" y2="1503.2266"/><line style="stroke:#000000;stroke-width:1.0;" x1="1368" x2="1368" y1="1503.2266" y2="1516.2266"/><line style="stroke:#000000;stroke-width:1.0;" x1="1327" x2="1368" y1="1516.2266" y2="1516.2266"/><polygon fill="#000000" points="1337,1512.2266,1327,1516.2266,1337,1520.2266,1333,1516.2266" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1333" y="1486.7998">21</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="38" x="1355" y="1476.1084">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="141" x="1355" y="1497.4912">owner-accesstoken</text><polygon fill="#000000" points="1801,1547.6094,1811,1551.6094,1801,1555.6094,1805,1551.6094" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1326" x2="1807" y1="1551.6094" y2="1551.6094"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1333" y="1545.874">22</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="116" x="1355" y="1545.874">HTTPS Forward</text><polygon fill="#000000" points="1337,1582.9922,1327,1586.9922,1337,1590.9922,1333,1586.9922" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1331" x2="1817" y1="1586.9922" y2="1586.9922"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1675" y="1581.2568">23</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="1697" y="1581.2568">result body json</text><polygon fill="#000000" points="322,1618.375,312,1622.375,322,1626.375,318,1622.375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="316" x2="1320" y1="1622.375" y2="1622.375"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1178" y="1616.6396">24</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="1200" y="1616.6396">result body json</text><path d="M189,1694.375 L450,1694.375 L450,1706.5 L440,1716.5 L189,1716.5 L189,1694.375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="304.8047" style="stroke:#000000;stroke-width:1.5;" width="1746" x="189" y="1694.375"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="216" x="204" y="1711.9844">FHIR-Ressourcen schreiben</text><polygon fill="#000000" points="1304,1786.2656,1314,1790.2656,1304,1794.2656,1308,1790.2656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="311" x2="1310" y1="1790.2656" y2="1790.2656"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="318" y="1773.8389">25</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="393" x="340" y="1763.1475">FHIR-Operationen um eigenen Datensatz zu verwalten</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="418" x="340" y="1784.5303">(owner-accesstoken, Flag für Sichtbarkeit des Endpoints)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1326" x2="1368" y1="1847.0313" y2="1847.0313"/><line style="stroke:#000000;stroke-width:1.0;" x1="1368" x2="1368" y1="1847.0313" y2="1860.0313"/><line style="stroke:#000000;stroke-width:1.0;" x1="1327" x2="1368" y1="1860.0313" y2="1860.0313"/><polygon fill="#000000" points="1337,1856.0313,1327,1860.0313,1337,1864.0313,1333,1860.0313" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1333" y="1830.6045">26</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="38" x="1355" y="1819.9131">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="141" x="1355" y="1841.2959">owner-accesstoken</text><polygon fill="#000000" points="1801,1891.4141,1811,1895.4141,1801,1899.4141,1805,1895.4141" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1326" x2="1807" y1="1895.4141" y2="1895.4141"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1333" y="1889.6787">27</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="116" x="1355" y="1889.6787">HTTPS Forward</text><polygon fill="#000000" points="1337,1926.7969,1327,1930.7969,1337,1934.7969,1333,1930.7969" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1331" x2="1817" y1="1930.7969" y2="1930.7969"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1675" y="1925.0615">28</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="1697" y="1925.0615">result body json</text><polygon fill="#000000" points="322,1962.1797,312,1966.1797,322,1970.1797,318,1966.1797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="316" x2="1320" y1="1966.1797" y2="1966.1797"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1178" y="1960.4443">29</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="1200" y="1960.4443">result body json</text><polygon fill="#000000" points="115,2029.5625,105,2033.5625,115,2037.5625,111,2033.5625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="109" x2="305" y1="2033.5625" y2="2033.5625"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="232" y="2027.8271">30</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="45" x="254" y="2027.8271">Status</text><!--MD5=[f0df7be9f438a5bf5f517f97a74d767c]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
}

autonumber

actor U as "Akteur in der Rolle\nUser-HBA"
box <size:18>Endgerät</size> #WhiteSmoke
  participant C as "TI-Messenger-Client"
  participant A as "Authenticator"
end box
participant konnektor as "Konnektor"
participant I as "zentraler IDP-Dienst" 
box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
  participant FP as "FHIR-Proxy"
  participant Auth as "Auth-Service"
  participant VZD as "FHIR-Directory"
end box

|||
note over U, I: \n<size:17>Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</size>\n
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges owner-accesstoken vorhanden</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: HTTP 302 Redirect to IDP Authorization Endpoint
  Deactivate Auth

  C->A++: Deeplink authenticator://...
  A->I: GET {auth_endpoint}
  Activate I

  'C->I: GET /authorize
  I- ->A: Authentication challenge
  A->konnektor++: ExternalAuthenticate

  'Activate A
  konnektor - -> A: ExternalAuthenticateResponse
  deactivate konnektor
  
  A->I: Authentication challenge response
  I- ->A: HTTP 302 Redirect(auth_code)
  Deactivate I
  A- ->C: {client_callback_uri}(auth_code)
'checkpoint

    Deactivate A
       
  |||          
  C->Auth: GET /signin-gematik-idp-dienst(auth_code)
    Activate Auth
  |||
  Auth->I: POST {tokenEndpoint}(auth_code, verifier)
  Activate I
  return id_token
  Deactivate I
  Auth->Auth: ID_TOKEN validieren(id_token)
  Auth->Auth: erzeuge \nowner-accesstoken(id_token)
  Auth- ->C: owner-accesstoken
    Deactivate Auth
  |||
end
      
|||

group <size:16>VZD-FHIR-Directory Eintrag</size>
  |||
  group <size:16>FHIR-Ressourcen lesen</size>
  |||
  C->FP: POST /owner/PractitionerRole/?... \nFinde Datensatz für eigene TelematikID(owner-accesstoken)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
  |||
  end
    
  |||
  group <size:16>FHIR-Ressourcen schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten\n(owner-accesstoken, Flag für Sichtbarkeit des Endpoints)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
     
  |||
  end

  C- ->U: Status    
    Deactivate C
  |||
end
|||

  Deactivate C
@enduml

@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
}

autonumber

actor U as "Akteur in der Rolle\nUser-HBA"
box <size:18>Endgerät</size> #WhiteSmoke
  participant C as "TI-Messenger-Client"
  participant A as "Authenticator"
end box
participant konnektor as "Konnektor"
participant I as "zentraler IDP-Dienst" 
box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
  participant FP as "FHIR-Proxy"
  participant Auth as "Auth-Service"
  participant VZD as "FHIR-Directory"
end box

|||
note over U, I: \n<size:17>Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</size>\n
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges owner-accesstoken vorhanden</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: HTTP 302 Redirect to IDP Authorization Endpoint
  Deactivate Auth

  C->A++: Deeplink authenticator://...
  A->I: GET {auth_endpoint}
  Activate I

  I- ->A: Authentication challenge
  A->konnektor++: ExternalAuthenticate

  konnektor - -> A: ExternalAuthenticateResponse
  deactivate konnektor
  
  A->I: Authentication challenge response
  I- ->A: HTTP 302 Redirect(auth_code)
  Deactivate I
  A- ->C: {client_callback_uri}(auth_code)

    Deactivate A
       
  |||          
  C->Auth: GET /signin-gematik-idp-dienst(auth_code)
    Activate Auth
  |||
  Auth->I: POST {tokenEndpoint}(auth_code, verifier)
  Activate I
  return id_token
  Deactivate I
  Auth->Auth: ID_TOKEN validieren(id_token)
  Auth->Auth: erzeuge \nowner-accesstoken(id_token)
  Auth- ->C: owner-accesstoken
    Deactivate Auth
  |||
end
      
|||

group <size:16>VZD-FHIR-Directory Eintrag</size>
  |||
  group <size:16>FHIR-Ressourcen lesen</size>
  |||
  C->FP: POST /owner/PractitionerRole/?... \nFinde Datensatz für eigene TelematikID(owner-accesstoken)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
  |||
  end
    
  |||
  group <size:16>FHIR-Ressourcen schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten\n(owner-accesstoken, Flag für Sichtbarkeit des Endpoints)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
     
  |||
  end

  C- ->U: Status    
    Deactivate C
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: de
Country: DE
--></g></svg>
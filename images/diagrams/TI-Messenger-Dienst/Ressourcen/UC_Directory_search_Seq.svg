<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2147px" preserveAspectRatio="none" style="width:1750px;height:2147px;background:#FFFFFF;" version="1.1" viewBox="0 0 1750 2147" width="1750px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2135.4219" style="stroke:#181818;stroke-width:0.5;" width="713" x="1025.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1279.5" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1479.5" y="23.8872"> </text><rect fill="#DCDCDC" height="1867.2969" style="stroke:#000000;stroke-width:1.0;" width="10" x="363.5" y="121.5625"/><rect fill="#DCDCDC" height="126.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="654.5" y="524.6875"/><rect fill="#DCDCDC" height="148.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="654.5" y="972.3828"/><rect fill="#DCDCDC" height="58.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="878.5" y="558.4766"/><rect fill="#DCDCDC" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="878.5" y="1006.1719"/><rect fill="#DCDCDC" height="643.375" style="stroke:#000000;stroke-width:1.0;" width="10" x="1131.5" y="1311.6953"/><rect fill="#DCDCDC" height="511.0625" style="stroke:#000000;stroke-width:1.0;" width="10" x="1364.5" y="709.8438"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1622.5" y="1633.3672"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1622.5" y="1830.4922"/><rect fill="#F0F8FF" height="820.5547" style="stroke:#000000;stroke-width:1.5;" width="1386" x="241.5" y="433.3516"/><rect fill="#FFE4E1" height="78.3828" style="stroke:#000000;stroke-width:1.5;" width="1235" x="251.5" y="836.2109"/><rect fill="#FFE4E1" height="79.5469" style="stroke:#000000;stroke-width:1.5;" width="1002" x="251.5" y="1423.4844"/><rect fill="#F0F8FF" height="158.125" style="stroke:#000000;stroke-width:1.5;" width="725" x="1019.5" y="1542.0313"/><rect fill="#F0F8FF" height="158.125" style="stroke:#000000;stroke-width:1.5;" width="725" x="1019.5" y="1739.1563"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="103" x2="103" y1="111.5625" y2="2031.8594"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="368.5" x2="368.5" y1="111.5625" y2="2031.8594"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="659.5" x2="659.5" y1="111.5625" y2="2031.8594"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="883.5" x2="883.5" y1="111.5625" y2="2031.8594"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1136.5" x2="1136.5" y1="111.5625" y2="2031.8594"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1369.5" x2="1369.5" y1="111.5625" y2="2031.8594"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1627.5" x2="1627.5" y1="111.5625" y2="2031.8594"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="7" y="83.5645">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="159" x="21" y="106.8457">User / User-HBA</text><ellipse cx="103.5" cy="13.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M103.5,21.5 L103.5,48.5 M90.5,29.5 L116.5,29.5 M103.5,48.5 L90.5,63.5 M103.5,48.5 L116.5,63.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="7" y="2049.4238">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="159" x="21" y="2072.7051">User / User-HBA</text><ellipse cx="103.5" cy="2085.9219" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M103.5,2093.9219 L103.5,2120.9219 M90.5,2101.9219 L116.5,2101.9219 M103.5,2120.9219 L90.5,2135.9219 M103.5,2120.9219 L116.5,2135.9219 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="261.5" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="269.5" y="98.8457">TI-Messenger-Client</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="261.5" y="2030.8594"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="269.5" y="2056.4238">TI-Messenger-Client</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="552.5" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="167" x="576" y="98.8457">Messenger Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="552.5" y="2030.8594"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="167" x="576" y="2056.4238">Messenger Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="776.5" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="189" x="789" y="98.8457">Matrix-Homeserver</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="776.5" y="2030.8594"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="189" x="789" y="2056.4238">Matrix-Homeserver</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1029.5" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="1082.5" y="98.8457">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1029.5" y="2030.8594"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="1082.5" y="2056.4238">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1262.5" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1305.5" y="98.8457">Auth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1262.5" y="2030.8594"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1305.5" y="2056.4238">Auth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1520.5" y="73.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1555" y="98.8457">FHIR-Directory</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1520.5" y="2030.8594"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1555" y="2056.4238">FHIR-Directory</text><rect fill="#DCDCDC" height="1867.2969" style="stroke:#000000;stroke-width:1.0;" width="10" x="363.5" y="121.5625"/><rect fill="#DCDCDC" height="126.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="654.5" y="524.6875"/><rect fill="#DCDCDC" height="148.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="654.5" y="972.3828"/><rect fill="#DCDCDC" height="58.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="878.5" y="558.4766"/><rect fill="#DCDCDC" height="80.5781" style="stroke:#000000;stroke-width:1.0;" width="10" x="878.5" y="1006.1719"/><rect fill="#DCDCDC" height="643.375" style="stroke:#000000;stroke-width:1.0;" width="10" x="1131.5" y="1311.6953"/><rect fill="#DCDCDC" height="511.0625" style="stroke:#000000;stroke-width:1.0;" width="10" x="1364.5" y="709.8438"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1622.5" y="1633.3672"/><rect fill="#DCDCDC" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1622.5" y="1830.4922"/><path d="M5,151.5625 L5,211.5625 L983,211.5625 L983,161.5625 L973,151.5625 L5,151.5625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M973,151.5625 L973,161.5625 L983,161.5625 L973,151.5625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="228.25" y="168.6294"> </text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="523" x="228.25" y="187.4751">Der Akteur ist erfolgreich beim Messenger-Service angemeldet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="228.25" y="203.5513"> </text><polygon fill="#000000" points="351.5,302.9844,361.5,306.9844,351.5,310.9844,355.5,306.9844" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="103.5" x2="357.5" y1="306.9844" y2="306.9844"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="158" x="110.5" y="261.397">Suchparameter für</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="142" x="110.5" y="281.186">FHIR-Ressourcen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="77" x="115.5" y="300.9751">eingeben</text><line style="stroke:#000000;stroke-width:1.0;" x1="373.5" x2="415.5" y1="380.3516" y2="380.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="415.5" y1="380.3516" y2="393.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="374.5" x2="415.5" y1="393.3516" y2="393.3516"/><polygon fill="#000000" points="384.5,389.3516,374.5,393.3516,384.5,397.3516,380.5,393.3516" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="185" x="380.5" y="334.7642">prüfe ob noch gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="380.5" y="354.5532">search-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="64" x="380.5" y="374.3423">vorliegt</text><path d="M241.5,433.3516 L305.5,433.3516 L305.5,440.4844 L295.5,450.4844 L241.5,450.4844 L241.5,433.3516 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="820.5547" style="stroke:#000000;stroke-width:1.5;" width="1386" x="241.5" y="433.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="256.5" y="446.4185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="320.5" y="451.3823">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="399" x="325.5" y="450.2031">kein gültiges search-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="724.5" y="451.3823">]</text><polygon fill="#000000" points="642.5,520.6875,652.5,524.6875,642.5,528.6875,646.5,524.6875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="373.5" x2="648.5" y1="524.6875" y2="524.6875"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="380.5" y="498.8892">GET /_matrix/client/user/</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="262" x="380.5" y="518.6782">{userId}/openid/request_token</text><polygon fill="#000000" points="866.5,554.4766,876.5,558.4766,866.5,562.4766,870.5,558.4766" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="664.5" x2="872.5" y1="558.4766" y2="558.4766"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="117" x="671.5" y="552.4673">HTTP Forward</text><polygon fill="#000000" points="675.5,613.2656,665.5,617.2656,675.5,621.2656,671.5,617.2656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="669.5" x2="882.5" y1="617.2656" y2="617.2656"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="180" x="696.5" y="611.2563">Matrix-OpenID-Token</text><polygon fill="#000000" points="384.5,647.0547,374.5,651.0547,384.5,655.0547,380.5,651.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="378.5" x2="658.5" y1="651.0547" y2="651.0547"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="142" x="510.5" y="645.0454">HTTP(S) Forward</text><polygon fill="#000000" points="1352.5,705.8438,1362.5,709.8438,1352.5,713.8438,1356.5,709.8438" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="373.5" x2="1358.5" y1="709.8438" y2="709.8438"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="698" x="380.5" y="703.8345">GET /tim-authenticate?MatrixServerName (Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1374.5" x2="1416.5" y1="783.2109" y2="783.2109"/><line style="stroke:#000000;stroke-width:1.0;" x1="1416.5" x2="1416.5" y1="783.2109" y2="796.2109"/><line style="stroke:#000000;stroke-width:1.0;" x1="1375.5" x2="1416.5" y1="796.2109" y2="796.2109"/><polygon fill="#000000" points="1385.5,792.2109,1375.5,796.2109,1385.5,800.2109,1381.5,796.2109" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="69" x="1381.5" y="737.6235">Prüfe ob</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="190" x="1381.5" y="757.4126">Matrix Server Name in</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="234" x="1381.5" y="777.2017">der Föderation enthalten ist</text><path d="M251.5,836.2109 L321.5,836.2109 L321.5,843.3438 L311.5,853.3438 L251.5,853.3438 L251.5,836.2109 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="78.3828" style="stroke:#000000;stroke-width:1.5;" width="1235" x="251.5" y="836.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="266.5" y="849.2778">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="336.5" y="854.2417">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="74" x="341.5" y="853.0625">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="415.5" y="854.2417">]</text><polygon fill="#000000" points="384.5,902.5938,374.5,906.5938,384.5,910.5938,380.5,906.5938" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="378.5" x2="1363.5" y1="906.5938" y2="906.5938"/><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="411" x="946.5" y="900.8203">Matrix Server Name nicht in der Föderation enthalten</text><polygon fill="#000000" points="675.5,968.3828,665.5,972.3828,675.5,976.3828,671.5,972.3828" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="669.5" x2="1363.5" y1="972.3828" y2="972.3828"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="377" x="980.5" y="966.3735">GET /openid/userinfo/?Matrix-OpenID-Token)</text><polygon fill="#000000" points="866.5,1002.1719,876.5,1006.1719,866.5,1010.1719,870.5,1006.1719" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="664.5" x2="872.5" y1="1006.1719" y2="1006.1719"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="142" x="671.5" y="1000.1626">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="888.5" x2="930.5" y1="1039.9609" y2="1039.9609"/><line style="stroke:#000000;stroke-width:1.0;" x1="930.5" x2="930.5" y1="1039.9609" y2="1052.9609"/><line style="stroke:#000000;stroke-width:1.0;" x1="889.5" x2="930.5" y1="1052.9609" y2="1052.9609"/><polygon fill="#000000" points="899.5,1048.9609,889.5,1052.9609,899.5,1056.9609,895.5,1052.9609" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="229" x="895.5" y="1033.9517">prüfe Matrix-OpenID-Token</text><polygon fill="#000000" points="675.5,1082.75,665.5,1086.75,675.5,1090.75,671.5,1086.75" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="669.5" x2="882.5" y1="1086.75" y2="1086.75"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="149" x="727.5" y="1080.7407">MXID des Nutzers</text><polygon fill="#000000" points="1352.5,1116.5391,1362.5,1120.5391,1352.5,1124.5391,1356.5,1120.5391" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="659.5" x2="1358.5" y1="1120.5391" y2="1120.5391"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="142" x="666.5" y="1114.5298">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1374.5" x2="1416.5" y1="1174.1172" y2="1174.1172"/><line style="stroke:#000000;stroke-width:1.0;" x1="1416.5" x2="1416.5" y1="1174.1172" y2="1187.1172"/><line style="stroke:#000000;stroke-width:1.0;" x1="1375.5" x2="1416.5" y1="1187.1172" y2="1187.1172"/><polygon fill="#000000" points="1385.5,1183.1172,1375.5,1187.1172,1385.5,1191.1172,1381.5,1187.1172" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="66" x="1381.5" y="1148.3188">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="1381.5" y="1168.1079">search-accesstoken</text><polygon fill="#000000" points="384.5,1216.9063,374.5,1220.9063,384.5,1224.9063,380.5,1220.9063" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="378.5" x2="1368.5" y1="1220.9063" y2="1220.9063"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="1202.5" y="1214.897">search-accesstoken</text><polygon fill="#000000" points="1119.5,1307.6953,1129.5,1311.6953,1119.5,1315.6953,1123.5,1311.6953" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="373.5" x2="1125.5" y1="1311.6953" y2="1311.6953"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="456" x="380.5" y="1305.686">POST /search?... (Auth Header mit search-accesstoken)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1141.5" x2="1183.5" y1="1370.4844" y2="1370.4844"/><line style="stroke:#000000;stroke-width:1.0;" x1="1183.5" x2="1183.5" y1="1370.4844" y2="1383.4844"/><line style="stroke:#000000;stroke-width:1.0;" x1="1142.5" x2="1183.5" y1="1383.4844" y2="1383.4844"/><polygon fill="#000000" points="1152.5,1379.4844,1142.5,1383.4844,1152.5,1387.4844,1148.5,1383.4844" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="209" x="1148.5" y="1364.4751">prüfe search-accesstoken</text><path d="M251.5,1423.4844 L321.5,1423.4844 L321.5,1430.6172 L311.5,1440.6172 L251.5,1440.6172 L251.5,1423.4844 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="79.5469" style="stroke:#000000;stroke-width:1.5;" width="1002" x="251.5" y="1423.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="266.5" y="1436.5513">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="336.5" y="1441.5151">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="74" x="341.5" y="1440.3359">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="415.5" y="1441.5151">]</text><polygon fill="#000000" points="384.5,1466.0313,374.5,1470.0313,384.5,1474.0313,380.5,1470.0313" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="378.5" x2="1130.5" y1="1470.0313" y2="1470.0313"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="272" x="852.5" y="1464.022">kein gültiges search-accesstoken</text><path d="M1019.5,1542.0313 L1083.5,1542.0313 L1083.5,1549.1641 L1073.5,1559.1641 L1019.5,1559.1641 L1019.5,1542.0313 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="158.125" style="stroke:#000000;stroke-width:1.5;" width="725" x="1019.5" y="1542.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="1034.5" y="1555.0981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1098.5" y="1560.062">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="391" x="1103.5" y="1558.8828">HealthcareService-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1494.5" y="1560.062">]</text><polygon fill="#000000" points="1610.5,1629.3672,1620.5,1633.3672,1610.5,1637.3672,1614.5,1633.3672" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1141.5" x2="1616.5" y1="1633.3672" y2="1633.3672"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="282" x="1148.5" y="1607.5688">POST /search/HealthcareService/?</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="272" x="1148.5" y="1627.3579">Finde Datensatz für TelematikID</text><polygon fill="#000000" points="1152.5,1663.1563,1142.5,1667.1563,1152.5,1671.1563,1148.5,1667.1563" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1146.5" x2="1626.5" y1="1667.1563" y2="1667.1563"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="236" x="1384.5" y="1661.147">Suchergebnis (FHIR Bundle)</text><path d="M1019.5,1739.1563 L1083.5,1739.1563 L1083.5,1746.2891 L1073.5,1756.2891 L1019.5,1756.2891 L1019.5,1739.1563 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="158.125" style="stroke:#000000;stroke-width:1.5;" width="725" x="1019.5" y="1739.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="1034.5" y="1752.2231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1098.5" y="1757.187">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="374" x="1103.5" y="1756.0078">PractitionerRole-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1477.5" y="1757.187">]</text><polygon fill="#000000" points="1610.5,1826.4922,1620.5,1830.4922,1610.5,1834.4922,1614.5,1830.4922" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1141.5" x2="1616.5" y1="1830.4922" y2="1830.4922"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="264" x="1148.5" y="1804.6938">POST /search/PractitionerRole/?</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="216" x="1153.5" y="1824.4829">Finde Datensatz für MXID</text><polygon fill="#000000" points="1152.5,1860.2813,1142.5,1864.2813,1152.5,1868.2813,1148.5,1864.2813" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1146.5" x2="1626.5" y1="1864.2813" y2="1864.2813"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="236" x="1384.5" y="1858.272">Suchergebnis (FHIR Bundle)</text><polygon fill="#000000" points="384.5,1951.0703,374.5,1955.0703,384.5,1959.0703,380.5,1955.0703" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="378.5" x2="1135.5" y1="1955.0703" y2="1955.0703"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="236" x="893.5" y="1949.061">Suchergebnis (FHIR Bundle)</text><polygon fill="#000000" points="114.5,1984.8594,104.5,1988.8594,114.5,1992.8594,110.5,1988.8594" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108.5" x2="367.5" y1="1988.8594" y2="1988.8594"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="236" x="125.5" y="1982.8501">Suchergebnis (FHIR Bundle)</text><!--MD5=[4d40498d0ac666e439b65fd957229fd6]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U as "Akteur in der Rolle\nUser / User-HBA"
    participant cl as "TI-Messenger-Client"
    participant mp as "Messenger Proxy"
    participant hs as "Matrix-Homeserver"
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant fp as "FHIR-Proxy"
      participant au as "Auth-Service"
      participant fd as "FHIR-Directory"
    end box

|||
note over U, hs: \n<size:17>Der Akteur ist erfolgreich beim Messenger-Service angemeldet</size>\n
|||

      activate cl
    U->cl:Suchparameter für \nFHIR-Ressourcen \n eingeben
    cl->cl: prüfe ob noch gültiges \nsearch-accesstoken\nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges search-accesstoken vorhanden</size>
|||
      

    cl->mp: GET /_matrix/client/user/\n{userId}/openid/request_token 
      activate mp
    mp->hs: HTTP Forward 

      activate hs
    |||
    hs- ->mp: Matrix-OpenID-Token
      deactivate hs
    mp- ->cl: HTTP(S) Forward
      deactivate mp
      
    |||
    cl->au: GET /tim-authenticate?MatrixServerName (Auth Header mit Matrix-OpenID-Token)
      activate au
    au->au: Prüfe ob \nMatrix Server Name in \nder Föderation enthalten ist

|||
opt#LightGrey #MistyRose <size:16>Abbruch</size>
|||    
    au- ->cl: <size:16>Matrix Server Name nicht in der Föderation enthalten</size>
end

|||
        au->mp: GET /openid/userinfo/?Matrix-OpenID-Token)
          activate mp
        mp->hs: HTTP(S) Forward
          activate hs
        hs->hs: prüfe Matrix-OpenID-Token
        hs- ->mp: MXID des Nutzers
          deactivate hs
        mp- ->au: HTTP(S) Forward
          deactivate mp
        au->au: erzeuge \nsearch-accesstoken 
        au- ->cl: search-accesstoken
          deactivate au
          deactivate fp
|||
end


    |||
    cl->fp: POST /search?... (Auth Header mit search-accesstoken)
    |||
      activate fp
    fp->fp: prüfe search-accesstoken
    |||
    opt#LightGrey #MistyRose <size:16>Abbruch</size>
      fp- ->cl: kein gültiges search-accesstoken 
    |||
    end
   
|||
alt#LightGrey #AliceBlue <size:16>HealthcareService-Einträge werden gesucht</size>
|||
    fp->fd: POST /search/HealthcareService/? \nFinde Datensatz für TelematikID 
      activate fd
    fd- ->fp: Suchergebnis (FHIR Bundle)
      deactivate fd
|||
end

|||
alt#LightGrey #AliceBlue <size:16>PractitionerRole-Einträge werden gesucht</size>
|||
    fp->fd: POST /search/PractitionerRole/? \n Finde Datensatz für MXID 
      activate fd
    fd- ->fp: Suchergebnis (FHIR Bundle)
      deactivate fd
|||
end
|||

  fp- ->cl: Suchergebnis (FHIR Bundle)
  deactivate fp
  cl- ->U: Suchergebnis (FHIR Bundle)
   |||
    
    deactivate cl

@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
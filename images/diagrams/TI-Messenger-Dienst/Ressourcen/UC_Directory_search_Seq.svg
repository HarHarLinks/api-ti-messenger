<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2229px" preserveAspectRatio="none" style="width:1682px;height:2229px;background:#FFFFFF;" version="1.1" viewBox="0 0 1682 2229" width="1682px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2217.4922" style="stroke:#181818;stroke-width:0.5;" width="693" x="977" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="171" x="1236" y="24.6855">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1407" y="25.7842"> </text><rect fill="#DCDCDC" height="1941.8672" style="stroke:#000000;stroke-width:1.0;" width="10" x="354" y="125.3125"/><rect fill="#DCDCDC" height="131.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="615" y="547.9375"/><rect fill="#DCDCDC" height="154.5313" style="stroke:#000000;stroke-width:1.0;" width="10" x="615" y="1013.8594"/><rect fill="#DCDCDC" height="60.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="839" y="583.3203"/><rect fill="#DCDCDC" height="83.7656" style="stroke:#000000;stroke-width:1.0;" width="10" x="839" y="1049.2422"/><rect fill="#DCDCDC" height="665.875" style="stroke:#000000;stroke-width:1.0;" width="10" x="1083" y="1365.9219"/><rect fill="#DCDCDC" height="534.0703" style="stroke:#000000;stroke-width:1.0;" width="10" x="1319" y="739.4688"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1554" y="1699.4063"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1554" y="1904.0313"/><rect fill="#F0F8FF" height="855.8438" style="stroke:#000000;stroke-width:1.5;" width="1327" x="232" y="450.6953"/><rect fill="#FFE4E1" height="83.8594" style="stroke:#000000;stroke-width:1.5;" width="1199" x="242" y="870.6172"/><rect fill="#FFE4E1" height="83.8594" style="stroke:#000000;stroke-width:1.5;" width="963" x="242" y="1479.3047"/><rect fill="#F0F8FF" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="705" x="971" y="1602.1641"/><rect fill="#F0F8FF" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="705" x="971" y="1806.7891"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="98" x2="98" y1="115.3125" y2="2110.1797"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="359" x2="359" y1="115.3125" y2="2110.1797"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="620" x2="620" y1="115.3125" y2="2110.1797"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="844" x2="844" y1="115.3125" y2="2110.1797"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1088" x2="1088" y1="115.3125" y2="2110.1797"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1324" x2="1324" y1="115.3125" y2="2110.1797"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1559" x2="1559" y1="115.3125" y2="2110.1797"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="14" y="85.7617">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="146" x="22" y="110.918">User / User-HBA</text><ellipse cx="98" cy="13.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M98,21.5 L98,48.5 M85,29.5 L111,29.5 M98,48.5 L85,63.5 M98,48.5 L111,63.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="14" y="2129.9414">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="146" x="22" y="2155.0977">User / User-HBA</text><ellipse cx="98" cy="2167.9922" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M98,2175.9922 L98,2202.9922 M85,2183.9922 L111,2183.9922 M98,2202.9922 L85,2217.9922 M98,2202.9922 L111,2217.9922 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="252" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179" x="269.5" y="102.918">TI-Messenger-Client</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="252" y="2109.1797"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179" x="269.5" y="2136.9414">TI-Messenger-Client</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="513" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="154" x="543" y="102.918">Messenger Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="513" y="2109.1797"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="154" x="543" y="2136.9414">Messenger Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="737" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="167" x="760.5" y="102.918">Matrix-Homeserver</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="737" y="2109.1797"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="167" x="760.5" y="2136.9414">Matrix-Homeserver</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="981" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="1037" y="102.918">FHIR-Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="981" y="2109.1797"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="1037" y="2136.9414">FHIR-Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1217" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="1268.5" y="102.918">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1217" y="2109.1797"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="1268.5" y="2136.9414">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1452" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="132" x="1493" y="102.918">FHIR-Directory</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1452" y="2109.1797"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="132" x="1493" y="2136.9414">FHIR-Directory</text><rect fill="#DCDCDC" height="1941.8672" style="stroke:#000000;stroke-width:1.0;" width="10" x="354" y="125.3125"/><rect fill="#DCDCDC" height="131.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="615" y="547.9375"/><rect fill="#DCDCDC" height="154.5313" style="stroke:#000000;stroke-width:1.0;" width="10" x="615" y="1013.8594"/><rect fill="#DCDCDC" height="60.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="839" y="583.3203"/><rect fill="#DCDCDC" height="83.7656" style="stroke:#000000;stroke-width:1.0;" width="10" x="839" y="1049.2422"/><rect fill="#DCDCDC" height="665.875" style="stroke:#000000;stroke-width:1.0;" width="10" x="1083" y="1365.9219"/><rect fill="#DCDCDC" height="534.0703" style="stroke:#000000;stroke-width:1.0;" width="10" x="1319" y="739.4688"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1554" y="1699.4063"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1554" y="1904.0313"/><path d="M5,155.3125 L5,219.3125 L937,219.3125 L937,165.3125 L927,155.3125 L5,155.3125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M927,155.3125 L927,165.3125 L937,165.3125 L927,155.3125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="238" y="173.8076"> </text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="457" x="238" y="194.3115">Der Akteur ist erfolgreich beim Messenger-Service angemeldet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="238" y="211.542"> </text><polygon fill="#000000" points="342,315.5469,352,319.5469,342,323.5469,346,319.5469" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="98" x2="348" y1="319.5469" y2="319.5469"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="105" y="292.4287">1</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="137" x="118" y="271.0459">Suchparameter für</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="130" x="118" y="292.4287">FHIR-Ressourcen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="67" x="123" y="313.8115">eingeben</text><line style="stroke:#000000;stroke-width:1.0;" x1="364" x2="406" y1="397.6953" y2="397.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="406" x2="406" y1="397.6953" y2="410.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="365" x2="406" y1="410.6953" y2="410.6953"/><polygon fill="#000000" points="375,406.6953,365,410.6953,375,414.6953,371,410.6953" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="371" y="370.5771">2</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="162" x="384" y="349.1943">prüfe ob noch gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="384" y="370.5771">search-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="384" y="391.96">vorliegt</text><path d="M232,450.6953 L293,450.6953 L293,459.0469 L283,469.0469 L232,469.0469 L232,450.6953 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="855.8438" style="stroke:#000000;stroke-width:1.5;" width="1327" x="232" y="450.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="247" y="465.1904">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="308" y="470.4033">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="342" x="312" y="469.3047">kein gültiges search-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="654" y="470.4033">]</text><polygon fill="#000000" points="603,543.9375,613,547.9375,603,551.9375,607,547.9375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="364" x2="609" y1="547.9375" y2="547.9375"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="371" y="531.5107">3</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="179" x="384" y="520.8193">GET /_matrix/client/user/</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="219" x="384" y="542.2021">{userId}/openid/request_token</text><polygon fill="#000000" points="827,579.3203,837,583.3203,827,587.3203,831,583.3203" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="625" x2="833" y1="583.3203" y2="583.3203"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="632" y="577.585">4</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="105" x="645" y="577.585">HTTP Forward</text><polygon fill="#000000" points="636,639.7031,626,643.7031,636,647.7031,632,643.7031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="630" x2="843" y1="643.7031" y2="643.7031"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="669" y="637.9678">5</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="155" x="682" y="637.9678">Matrix-OpenID-Token</text><polygon fill="#000000" points="375,675.0859,365,679.0859,375,683.0859,371,679.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="369" x2="619" y1="679.0859" y2="679.0859"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="472" y="673.3506">6</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="485" y="673.3506">HTTP(S) Forward</text><polygon fill="#000000" points="1307,735.4688,1317,739.4688,1307,743.4688,1311,739.4688" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="364" x2="1313" y1="739.4688" y2="739.4688"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="371" y="733.7334">7</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="519" x="384" y="733.7334">GET /tim-authenticate?mxId=... (Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1329" x2="1371" y1="817.6172" y2="817.6172"/><line style="stroke:#000000;stroke-width:1.0;" x1="1371" x2="1371" y1="817.6172" y2="830.6172"/><line style="stroke:#000000;stroke-width:1.0;" x1="1330" x2="1371" y1="830.6172" y2="830.6172"/><polygon fill="#000000" points="1340,826.6172,1330,830.6172,1340,834.6172,1336,830.6172" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1336" y="790.499">8</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="63" x="1349" y="769.1162">Prüfe ob</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="161" x="1349" y="790.499">Matrix Server Name in</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="198" x="1349" y="811.8818">der Föderation enthalten ist</text><path d="M242,870.6172 L307,870.6172 L307,878.9688 L297,888.9688 L242,888.9688 L242,870.6172 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="83.8594" style="stroke:#000000;stroke-width:1.5;" width="1199" x="242" y="870.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="257" y="885.1123">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="322" y="890.3252">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="66" x="326" y="889.2266">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="392" y="890.3252">]</text><polygon fill="#000000" points="375,942.4766,365,946.4766,375,950.4766,371,946.4766" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="369" x2="1318" y1="946.4766" y2="946.4766"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="936" y="940.7412">9</text><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="363" x="949" y="940.332">Matrix Server Name nicht in der Föderation enthalten</text><polygon fill="#000000" points="636,1009.8594,626,1013.8594,636,1017.8594,632,1013.8594" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="630" x2="1318" y1="1013.8594" y2="1013.8594"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="861" y="1008.124">10</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="429" x="883" y="1008.124">GET /openid/userinfo?access_token=Matrix-OpenID-Token</text><polygon fill="#000000" points="827,1045.2422,837,1049.2422,827,1053.2422,831,1049.2422" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="625" x2="833" y1="1049.2422" y2="1049.2422"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="632" y="1043.5068">11</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="654" y="1043.5068">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="849" x2="891" y1="1084.625" y2="1084.625"/><line style="stroke:#000000;stroke-width:1.0;" x1="891" x2="891" y1="1084.625" y2="1097.625"/><line style="stroke:#000000;stroke-width:1.0;" x1="850" x2="891" y1="1097.625" y2="1097.625"/><polygon fill="#000000" points="860,1093.625,850,1097.625,860,1101.625,856,1097.625" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="856" y="1078.8896">12</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="198" x="878" y="1078.8896">prüfe Matrix-OpenID-Token</text><polygon fill="#000000" points="636,1129.0078,626,1133.0078,636,1137.0078,632,1133.0078" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="630" x2="843" y1="1133.0078" y2="1133.0078"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="683" y="1127.2725">13</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="705" y="1127.2725">MXID des Nutzers</text><polygon fill="#000000" points="1307,1164.3906,1317,1168.3906,1307,1172.3906,1311,1168.3906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="620" x2="1313" y1="1168.3906" y2="1168.3906"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="627" y="1162.6553">14</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="649" y="1162.6553">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1329" x2="1371" y1="1225.1563" y2="1225.1563"/><line style="stroke:#000000;stroke-width:1.0;" x1="1371" x2="1371" y1="1225.1563" y2="1238.1563"/><line style="stroke:#000000;stroke-width:1.0;" x1="1330" x2="1371" y1="1238.1563" y2="1238.1563"/><polygon fill="#000000" points="1340,1234.1563,1330,1238.1563,1340,1242.1563,1336,1238.1563" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1336" y="1208.7295">15</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="59" x="1358" y="1198.0381">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="1358" y="1219.4209">search-accesstoken</text><polygon fill="#000000" points="375,1269.5391,365,1273.5391,375,1277.5391,371,1273.5391" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="369" x2="1323" y1="1273.5391" y2="1273.5391"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1148" y="1267.8037">16</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="1170" y="1267.8037">search-accesstoken</text><polygon fill="#000000" points="1071,1361.9219,1081,1365.9219,1071,1369.9219,1075,1365.9219" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="364" x2="1077" y1="1365.9219" y2="1365.9219"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="371" y="1360.1865">17</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="413" x="393" y="1360.1865">POST /search?... (Auth Header mit search-accesstoken)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1093" x2="1135" y1="1426.3047" y2="1426.3047"/><line style="stroke:#000000;stroke-width:1.0;" x1="1135" x2="1135" y1="1426.3047" y2="1439.3047"/><line style="stroke:#000000;stroke-width:1.0;" x1="1094" x2="1135" y1="1439.3047" y2="1439.3047"/><polygon fill="#000000" points="1104,1435.3047,1094,1439.3047,1104,1443.3047,1100,1439.3047" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1100" y="1420.5693">18</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="190" x="1122" y="1420.5693">prüfe search-accesstoken</text><path d="M242,1479.3047 L307,1479.3047 L307,1487.6563 L297,1497.6563 L242,1497.6563 L242,1479.3047 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="83.8594" style="stroke:#000000;stroke-width:1.5;" width="963" x="242" y="1479.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="257" y="1493.7998">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="322" y="1499.0127">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="66" x="326" y="1497.9141">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="392" y="1499.0127">]</text><polygon fill="#000000" points="375,1526.1641,365,1530.1641,375,1534.1641,371,1530.1641" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="369" x2="1082" y1="1530.1641" y2="1530.1641"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="812" y="1524.4287">19</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="242" x="834" y="1524.4287">kein gültiges search-accesstoken</text><path d="M971,1602.1641 L1032,1602.1641 L1032,1610.5156 L1022,1620.5156 L971,1620.5156 L971,1602.1641 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="705" x="971" y="1602.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="986" y="1616.6592">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1047" y="1621.8721">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="335" x="1051" y="1620.7734">HealthcareService-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1386" y="1621.8721">]</text><polygon fill="#000000" points="1542,1695.4063,1552,1699.4063,1542,1703.4063,1546,1699.4063" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1093" x2="1548" y1="1699.4063" y2="1699.4063"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1100" y="1682.9795">20</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="255" x="1122" y="1672.2881">POST /search/HealthcareService/?</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="233" x="1122" y="1693.6709">Finde Datensatz für TelematikID</text><polygon fill="#000000" points="1104,1730.7891,1094,1734.7891,1104,1738.7891,1100,1734.7891" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1098" x2="1558" y1="1734.7891" y2="1734.7891"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1320" y="1729.0537">21</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="1342" y="1729.0537">Suchergebnis (FHIR Bundle)</text><path d="M971,1806.7891 L1032,1806.7891 L1032,1815.1406 L1022,1825.1406 L971,1825.1406 L971,1806.7891 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="705" x="971" y="1806.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="986" y="1821.2842">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1047" y="1826.4971">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="319" x="1051" y="1825.3984">PractitionerRole-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1370" y="1826.4971">]</text><polygon fill="#000000" points="1542,1900.0313,1552,1904.0313,1542,1908.0313,1546,1904.0313" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1093" x2="1548" y1="1904.0313" y2="1904.0313"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1100" y="1887.6045">22</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="238" x="1122" y="1876.9131">POST /search/PractitionerRole/?</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="189" x="1127" y="1898.2959">Finde Datensatz für MXID</text><polygon fill="#000000" points="1104,1935.4141,1094,1939.4141,1104,1943.4141,1100,1939.4141" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1098" x2="1558" y1="1939.4141" y2="1939.4141"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1320" y="1933.6787">23</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="1342" y="1933.6787">Suchergebnis (FHIR Bundle)</text><polygon fill="#000000" points="375,2027.7969,365,2031.7969,375,2035.7969,371,2031.7969" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="369" x2="1087" y1="2031.7969" y2="2031.7969"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="849" y="2026.0615">24</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="871" y="2026.0615">Suchergebnis (FHIR Bundle)</text><polygon fill="#000000" points="109,2063.1797,99,2067.1797,109,2071.1797,105,2067.1797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="103" x2="358" y1="2067.1797" y2="2067.1797"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="120" y="2061.4443">25</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="142" y="2061.4443">Suchergebnis (FHIR Bundle)</text><!--MD5=[5ede32265ac143376425cb90f6350153]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20

}
autonumber

actor U as "Akteur in der Rolle\nUser / User-HBA"
participant cl as "TI-Messenger-Client"
participant mp as "Messenger Proxy"
participant hs as "Matrix-Homeserver"
box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
  participant fp as "FHIR-Proxy"
  participant au as "Auth-Service"
  participant fd as "FHIR-Directory"
end box

|||
note over U, hs: \n<size:17>Der Akteur ist erfolgreich beim Messenger-Service angemeldet</size>\n
|||

      activate cl
    U->cl:Suchparameter für \nFHIR-Ressourcen \n eingeben
    cl->cl: prüfe ob noch gültiges \nsearch-accesstoken\nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges search-accesstoken vorhanden</size>
|||
      

    cl->mp: GET /_matrix/client/user/\n{userId}/openid/request_token 
      activate mp
    mp->hs: HTTP Forward 

      activate hs
    |||
    hs- ->mp: Matrix-OpenID-Token
      deactivate hs
    mp- ->cl: HTTP(S) Forward
      deactivate mp
      
    |||
    cl->au: GET /tim-authenticate?mxId=... (Auth Header mit Matrix-OpenID-Token)
      activate au
    au->au: Prüfe ob \nMatrix Server Name in \nder Föderation enthalten ist

|||
opt#LightGrey #MistyRose <size:16>Abbruch</size>
|||    
    au- ->cl: <size:16>Matrix Server Name nicht in der Föderation enthalten</size>
end

|||
        au->mp: GET /openid/userinfo?access_token=Matrix-OpenID-Token
          activate mp
        mp->hs: HTTP(S) Forward
          activate hs
        hs->hs: prüfe Matrix-OpenID-Token
        hs- ->mp: MXID des Nutzers
          deactivate hs
        mp- ->au: HTTP(S) Forward
          deactivate mp
        au->au: erzeuge \nsearch-accesstoken 
        au- ->cl: search-accesstoken
          deactivate au
          deactivate fp
|||
end


    |||
    cl->fp: POST /search?... (Auth Header mit search-accesstoken)
    |||
      activate fp
    fp->fp: prüfe search-accesstoken
    |||
    opt#LightGrey #MistyRose <size:16>Abbruch</size>
      fp- ->cl: kein gültiges search-accesstoken 
    |||
    end
   
|||
alt#LightGrey #AliceBlue <size:16>HealthcareService-Einträge werden gesucht</size>
|||
    fp->fd: POST /search/HealthcareService/? \nFinde Datensatz für TelematikID 
      activate fd
    fd- ->fp: Suchergebnis (FHIR Bundle)
      deactivate fd
|||
end

|||
alt#LightGrey #AliceBlue <size:16>PractitionerRole-Einträge werden gesucht</size>
|||
    fp->fd: POST /search/PractitionerRole/? \n Finde Datensatz für MXID 
      activate fd
    fd- ->fp: Suchergebnis (FHIR Bundle)
      deactivate fd
|||
end
|||

  fp- ->cl: Suchergebnis (FHIR Bundle)
  deactivate fp
  cl- ->U: Suchergebnis (FHIR Bundle)
   |||
    
    deactivate cl

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: de
Country: DE
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2228px" preserveAspectRatio="none" style="width:1605px;height:2228px;background:#FFFFFF;" version="1.1" viewBox="0 0 1605 2228" width="1605px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2216.2344" style="stroke:#181818;stroke-width:0.5;" width="670" x="923" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="171" x="1170.5" y="24.6855">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1341.5" y="25.7842"> </text><rect fill="#DCDCDC" height="1940.6094" style="stroke:#000000;stroke-width:1.0;" width="10" x="332" y="125.3125"/><rect fill="#DCDCDC" height="131.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="580" y="547.9375"/><rect fill="#DCDCDC" height="154.5313" style="stroke:#000000;stroke-width:1.0;" width="10" x="580" y="1012.6016"/><rect fill="#DCDCDC" height="60.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="804" y="583.3203"/><rect fill="#DCDCDC" height="83.7656" style="stroke:#000000;stroke-width:1.0;" width="10" x="804" y="1047.9844"/><rect fill="#DCDCDC" height="665.875" style="stroke:#000000;stroke-width:1.0;" width="10" x="1029" y="1364.6641"/><rect fill="#DCDCDC" height="532.8125" style="stroke:#000000;stroke-width:1.0;" width="10" x="1253" y="739.4688"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1698.1484"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1902.7734"/><rect fill="#F0F8FF" height="854.5859" style="stroke:#000000;stroke-width:1.5;" width="1270" x="210" y="450.6953"/><rect fill="#FFE4E1" height="82.6016" style="stroke:#000000;stroke-width:1.5;" width="1155" x="220" y="870.6172"/><rect fill="#FFE4E1" height="83.8594" style="stroke:#000000;stroke-width:1.5;" width="931" x="220" y="1478.0469"/><rect fill="#F0F8FF" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="682" x="917" y="1600.9063"/><rect fill="#F0F8FF" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="682" x="917" y="1805.5313"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="98" x2="98" y1="115.3125" y2="2108.9219"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="337" x2="337" y1="115.3125" y2="2108.9219"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="585" x2="585" y1="115.3125" y2="2108.9219"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="809" x2="809" y1="115.3125" y2="2108.9219"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1034" x2="1034" y1="115.3125" y2="2108.9219"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1258" x2="1258" y1="115.3125" y2="2108.9219"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1482" x2="1482" y1="115.3125" y2="2108.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="14" y="85.7617">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="146" x="22" y="110.918">User / User-HBA</text><ellipse cx="98" cy="13.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M98,21.5 L98,48.5 M85,29.5 L111,29.5 M98,48.5 L85,63.5 M98,48.5 L111,63.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="14" y="2128.6836">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="146" x="22" y="2153.8398">User / User-HBA</text><ellipse cx="98" cy="2166.7344" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M98,2174.7344 L98,2201.7344 M85,2182.7344 L111,2182.7344 M98,2201.7344 L85,2216.7344 M98,2201.7344 L111,2216.7344 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="230" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179" x="247.5" y="102.918">TI-Messenger-Client</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="230" y="2107.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="179" x="247.5" y="2135.6836">TI-Messenger-Client</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="478" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="154" x="508" y="102.918">Messenger Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="478" y="2107.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="154" x="508" y="2135.6836">Messenger Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="702" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="167" x="725.5" y="102.918">Matrix-Homeserver</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="702" y="2107.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="167" x="725.5" y="2135.6836">Matrix-Homeserver</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="927" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="983" y="102.918">FHIR-Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="927" y="2107.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="102" x="983" y="2135.6836">FHIR-Proxy</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1151" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="1202.5" y="102.918">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1151" y="2107.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="111" x="1202.5" y="2135.6836">Auth-Service</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1375" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="132" x="1416" y="102.918">FHIR-Directory</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1375" y="2107.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="132" x="1416" y="2135.6836">FHIR-Directory</text><rect fill="#DCDCDC" height="1940.6094" style="stroke:#000000;stroke-width:1.0;" width="10" x="332" y="125.3125"/><rect fill="#DCDCDC" height="131.1484" style="stroke:#000000;stroke-width:1.0;" width="10" x="580" y="547.9375"/><rect fill="#DCDCDC" height="154.5313" style="stroke:#000000;stroke-width:1.0;" width="10" x="580" y="1012.6016"/><rect fill="#DCDCDC" height="60.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="804" y="583.3203"/><rect fill="#DCDCDC" height="83.7656" style="stroke:#000000;stroke-width:1.0;" width="10" x="804" y="1047.9844"/><rect fill="#DCDCDC" height="665.875" style="stroke:#000000;stroke-width:1.0;" width="10" x="1029" y="1364.6641"/><rect fill="#DCDCDC" height="532.8125" style="stroke:#000000;stroke-width:1.0;" width="10" x="1253" y="739.4688"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1698.1484"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1902.7734"/><path d="M5,155.3125 L5,219.3125 L902,219.3125 L902,165.3125 L892,155.3125 L5,155.3125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M892,155.3125 L892,165.3125 L902,165.3125 L892,155.3125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="220.5" y="173.8076"> </text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="457" x="220.5" y="194.3115">Der Akteur ist erfolgreich beim Messenger-Service angemeldet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="220.5" y="211.542"> </text><polygon fill="#000000" points="320,315.5469,330,319.5469,320,323.5469,324,319.5469" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="98" x2="326" y1="319.5469" y2="319.5469"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="137" x="105" y="271.0459">Suchparameter für</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="130" x="105" y="292.4287">FHIR-Ressourcen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="67" x="110" y="313.8115">eingeben</text><line style="stroke:#000000;stroke-width:1.0;" x1="342" x2="384" y1="397.6953" y2="397.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="384" x2="384" y1="397.6953" y2="410.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="343" x2="384" y1="410.6953" y2="410.6953"/><polygon fill="#000000" points="353,406.6953,343,410.6953,353,414.6953,349,410.6953" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="162" x="349" y="349.1943">prüfe ob noch gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="349" y="370.5771">search-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="349" y="391.96">vorliegt</text><path d="M210,450.6953 L271,450.6953 L271,459.0469 L261,469.0469 L210,469.0469 L210,450.6953 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="854.5859" style="stroke:#000000;stroke-width:1.5;" width="1270" x="210" y="450.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="225" y="465.1904">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="286" y="470.4033">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="342" x="290" y="469.3047">kein gültiges search-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="632" y="470.4033">]</text><polygon fill="#000000" points="568,543.9375,578,547.9375,568,551.9375,572,547.9375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="342" x2="574" y1="547.9375" y2="547.9375"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="179" x="349" y="520.8193">GET /_matrix/client/user/</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="219" x="349" y="542.2021">{userId}/openid/request_token</text><polygon fill="#000000" points="792,579.3203,802,583.3203,792,587.3203,796,583.3203" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="590" x2="798" y1="583.3203" y2="583.3203"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="105" x="597" y="577.585">HTTP Forward</text><polygon fill="#000000" points="601,639.7031,591,643.7031,601,647.7031,597,643.7031" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="595" x2="808" y1="643.7031" y2="643.7031"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="155" x="647" y="637.9678">Matrix-OpenID-Token</text><polygon fill="#000000" points="353,675.0859,343,679.0859,353,683.0859,349,679.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="584" y1="679.0859" y2="679.0859"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="450" y="673.3506">HTTP(S) Forward</text><polygon fill="#000000" points="1241,735.4688,1251,739.4688,1241,743.4688,1245,739.4688" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="342" x2="1247" y1="739.4688" y2="739.4688"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="519" x="349" y="733.7334">GET /tim-authenticate?mxId=... (Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1263" x2="1305" y1="817.6172" y2="817.6172"/><line style="stroke:#000000;stroke-width:1.0;" x1="1305" x2="1305" y1="817.6172" y2="830.6172"/><line style="stroke:#000000;stroke-width:1.0;" x1="1264" x2="1305" y1="830.6172" y2="830.6172"/><polygon fill="#000000" points="1274,826.6172,1264,830.6172,1274,834.6172,1270,830.6172" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="63" x="1270" y="769.1162">Prüfe ob</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="161" x="1270" y="790.499">Matrix Server Name in</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="198" x="1270" y="811.8818">der Föderation enthalten ist</text><path d="M220,870.6172 L285,870.6172 L285,878.9688 L275,888.9688 L220,888.9688 L220,870.6172 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="82.6016" style="stroke:#000000;stroke-width:1.5;" width="1155" x="220" y="870.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="235" y="885.1123">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="300" y="890.3252">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="66" x="304" y="889.2266">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="370" y="890.3252">]</text><polygon fill="#000000" points="353,941.2188,343,945.2188,353,949.2188,349,945.2188" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="1252" y1="945.2188" y2="945.2188"/><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="363" x="883" y="939.7031">Matrix Server Name nicht in der Föderation enthalten</text><polygon fill="#000000" points="601,1008.6016,591,1012.6016,601,1016.6016,597,1012.6016" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="595" x2="1252" y1="1012.6016" y2="1012.6016"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="435" x="811" y="1006.8662">GET /openid/userinfo?access_token=Matrix-OpenID-Token)</text><polygon fill="#000000" points="792,1043.9844,802,1047.9844,792,1051.9844,796,1047.9844" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="590" x2="798" y1="1047.9844" y2="1047.9844"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="597" y="1042.249">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="814" x2="856" y1="1083.3672" y2="1083.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="856" x2="856" y1="1083.3672" y2="1096.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="815" x2="856" y1="1096.3672" y2="1096.3672"/><polygon fill="#000000" points="825,1092.3672,815,1096.3672,825,1100.3672,821,1096.3672" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="198" x="821" y="1077.6318">prüfe Matrix-OpenID-Token</text><polygon fill="#000000" points="601,1127.75,591,1131.75,601,1135.75,597,1131.75" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="595" x2="808" y1="1131.75" y2="1131.75"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="670" y="1126.0146">MXID des Nutzers</text><polygon fill="#000000" points="1241,1163.1328,1251,1167.1328,1241,1171.1328,1245,1167.1328" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="585" x2="1247" y1="1167.1328" y2="1167.1328"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="592" y="1161.3975">HTTP(S) Forward</text><line style="stroke:#000000;stroke-width:1.0;" x1="1263" x2="1305" y1="1223.8984" y2="1223.8984"/><line style="stroke:#000000;stroke-width:1.0;" x1="1305" x2="1305" y1="1223.8984" y2="1236.8984"/><line style="stroke:#000000;stroke-width:1.0;" x1="1264" x2="1305" y1="1236.8984" y2="1236.8984"/><polygon fill="#000000" points="1274,1232.8984,1264,1236.8984,1274,1240.8984,1270,1236.8984" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="59" x="1270" y="1196.7803">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="1270" y="1218.1631">search-accesstoken</text><polygon fill="#000000" points="353,1268.2813,343,1272.2813,353,1276.2813,349,1272.2813" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="1257" y1="1272.2813" y2="1272.2813"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="1104" y="1266.5459">search-accesstoken</text><polygon fill="#000000" points="1017,1360.6641,1027,1364.6641,1017,1368.6641,1021,1364.6641" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="342" x2="1023" y1="1364.6641" y2="1364.6641"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="413" x="349" y="1358.9287">POST /search?... (Auth Header mit search-accesstoken)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1039" x2="1081" y1="1425.0469" y2="1425.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="1081" x2="1081" y1="1425.0469" y2="1438.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="1040" x2="1081" y1="1438.0469" y2="1438.0469"/><polygon fill="#000000" points="1050,1434.0469,1040,1438.0469,1050,1442.0469,1046,1438.0469" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="190" x="1046" y="1419.3115">prüfe search-accesstoken</text><path d="M220,1478.0469 L285,1478.0469 L285,1486.3984 L275,1496.3984 L220,1496.3984 L220,1478.0469 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="83.8594" style="stroke:#000000;stroke-width:1.5;" width="931" x="220" y="1478.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="235" y="1492.542">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="300" y="1497.7549">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="66" x="304" y="1496.6563">Abbruch</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="370" y="1497.7549">]</text><polygon fill="#000000" points="353,1524.9063,343,1528.9063,353,1532.9063,349,1528.9063" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="1028" y1="1528.9063" y2="1528.9063"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="242" x="780" y="1523.1709">kein gültiges search-accesstoken</text><path d="M917,1600.9063 L978,1600.9063 L978,1609.2578 L968,1619.2578 L917,1619.2578 L917,1600.9063 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="682" x="917" y="1600.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="932" y="1615.4014">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="993" y="1620.6143">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="335" x="997" y="1619.5156">HealthcareService-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1332" y="1620.6143">]</text><polygon fill="#000000" points="1465,1694.1484,1475,1698.1484,1465,1702.1484,1469,1698.1484" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1039" x2="1471" y1="1698.1484" y2="1698.1484"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="255" x="1046" y="1671.0303">POST /search/HealthcareService/?</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="233" x="1046" y="1692.4131">Finde Datensatz für TelematikID</text><polygon fill="#000000" points="1050,1729.5313,1040,1733.5313,1050,1737.5313,1046,1733.5313" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1044" x2="1481" y1="1733.5313" y2="1733.5313"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="1265" y="1727.7959">Suchergebnis (FHIR Bundle)</text><path d="M917,1805.5313 L978,1805.5313 L978,1813.8828 L968,1823.8828 L917,1823.8828 L917,1805.5313 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="165.625" style="stroke:#000000;stroke-width:1.5;" width="682" x="917" y="1805.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="932" y="1820.0264">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="993" y="1825.2393">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="319" x="997" y="1824.1406">PractitionerRole-Einträge werden gesucht</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="1316" y="1825.2393">]</text><polygon fill="#000000" points="1465,1898.7734,1475,1902.7734,1465,1906.7734,1469,1902.7734" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1039" x2="1471" y1="1902.7734" y2="1902.7734"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="238" x="1046" y="1875.6553">POST /search/PractitionerRole/?</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="189" x="1051" y="1897.0381">Finde Datensatz für MXID</text><polygon fill="#000000" points="1050,1934.1563,1040,1938.1563,1050,1942.1563,1046,1938.1563" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1044" x2="1481" y1="1938.1563" y2="1938.1563"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="1265" y="1932.4209">Suchergebnis (FHIR Bundle)</text><polygon fill="#000000" points="353,2026.5391,343,2030.5391,353,2034.5391,349,2030.5391" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347" x2="1033" y1="2030.5391" y2="2030.5391"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="817" y="2024.8037">Suchergebnis (FHIR Bundle)</text><polygon fill="#000000" points="109,2061.9219,99,2065.9219,109,2069.9219,105,2065.9219" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="103" x2="336" y1="2065.9219" y2="2065.9219"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="120" y="2060.1865">Suchergebnis (FHIR Bundle)</text><!--MD5=[490945c3a3a8daac399320cae8a939b2]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
}
    actor U as "Akteur in der Rolle\nUser / User-HBA"
    participant cl as "TI-Messenger-Client"
    participant mp as "Messenger Proxy"
    participant hs as "Matrix-Homeserver"
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant fp as "FHIR-Proxy"
      participant au as "Auth-Service"
      participant fd as "FHIR-Directory"
    end box

|||
note over U, hs: \n<size:17>Der Akteur ist erfolgreich beim Messenger-Service angemeldet</size>\n
|||

      activate cl
    U->cl:Suchparameter für \nFHIR-Ressourcen \n eingeben
    cl->cl: prüfe ob noch gültiges \nsearch-accesstoken\nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültiges search-accesstoken vorhanden</size>
|||
      

    cl->mp: GET /_matrix/client/user/\n{userId}/openid/request_token 
      activate mp
    mp->hs: HTTP Forward 

      activate hs
    |||
    hs- ->mp: Matrix-OpenID-Token
      deactivate hs
    mp- ->cl: HTTP(S) Forward
      deactivate mp
      
    |||
    cl->au: GET /tim-authenticate?mxId=... (Auth Header mit Matrix-OpenID-Token)
      activate au
    au->au: Prüfe ob \nMatrix Server Name in \nder Föderation enthalten ist

|||
opt#LightGrey #MistyRose <size:16>Abbruch</size>
|||    
    au- ->cl: <size:16>Matrix Server Name nicht in der Föderation enthalten</size>
end

|||
        au->mp: GET /openid/userinfo?access_token=Matrix-OpenID-Token)
          activate mp
        mp->hs: HTTP(S) Forward
          activate hs
        hs->hs: prüfe Matrix-OpenID-Token
        hs- ->mp: MXID des Nutzers
          deactivate hs
        mp- ->au: HTTP(S) Forward
          deactivate mp
        au->au: erzeuge \nsearch-accesstoken 
        au- ->cl: search-accesstoken
          deactivate au
          deactivate fp
|||
end


    |||
    cl->fp: POST /search?... (Auth Header mit search-accesstoken)
    |||
      activate fp
    fp->fp: prüfe search-accesstoken
    |||
    opt#LightGrey #MistyRose <size:16>Abbruch</size>
      fp- ->cl: kein gültiges search-accesstoken 
    |||
    end
   
|||
alt#LightGrey #AliceBlue <size:16>HealthcareService-Einträge werden gesucht</size>
|||
    fp->fd: POST /search/HealthcareService/? \nFinde Datensatz für TelematikID 
      activate fd
    fd- ->fp: Suchergebnis (FHIR Bundle)
      deactivate fd
|||
end

|||
alt#LightGrey #AliceBlue <size:16>PractitionerRole-Einträge werden gesucht</size>
|||
    fp->fd: POST /search/PractitionerRole/? \n Finde Datensatz für MXID 
      activate fd
    fd- ->fp: Suchergebnis (FHIR Bundle)
      deactivate fd
|||
end
|||

  fp- ->cl: Suchergebnis (FHIR Bundle)
  deactivate fp
  cl- ->U: Suchergebnis (FHIR Bundle)
   |||
    
    deactivate cl

@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: de
Country: DE
--></g></svg>
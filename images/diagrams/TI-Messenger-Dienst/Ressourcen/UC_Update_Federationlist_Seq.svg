<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1495px" preserveAspectRatio="none" style="width:1518px;height:1495px;background:#FFFFFF;" version="1.1" viewBox="0 0 1518 1495" width="1518px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="1483.9922" style="stroke:#181818;stroke-width:0.5;" width="548" x="26" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="193" x="203.5" y="22.708">Messenger-Service</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="203.5" y="39.02"> </text><rect fill="#F5F5F5" height="1483.9922" style="stroke:#181818;stroke-width:0.5;" width="446" x="992.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1113" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="5" x="1313" y="23.8872"> </text><rect fill="#DCDCDC" height="1234.8242" style="stroke:#000000;stroke-width:1.0;" width="10" x="132" y="156.8867"/><rect fill="#DCDCDC" height="1143.0352" style="stroke:#000000;stroke-width:1.0;" width="10" x="691.5" y="156.8867"/><rect fill="#DCDCDC" height="755.2344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1098.5" y="510.8984"/><rect fill="#DCDCDC" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1322.5" y="299.9531"/><rect fill="#F0F8FF" height="224.7031" style="stroke:#000000;stroke-width:1.5;" width="941.5" x="571" y="208.6172"/><rect fill="#F0F8FF" height="663.8672" style="stroke:#000000;stroke-width:1.5;" width="1210.5" x="10" y="767.8438"/><rect fill="#ADD8E6" height="255.75" style="stroke:#000000;stroke-width:1.5;" width="802" x="20" y="931.9688"/><rect fill="#ADD8E6" height="151.2031" style="stroke:none;stroke-width:1.0;" width="802" x="20" y="1036.5156"/><rect fill="#F0F8FF" height="211.9922" style="stroke:none;stroke-width:1.0;" width="1210.5" x="10" y="1219.7188"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="137" x2="137" y1="84.3672" y2="1448.7109"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="463" x2="463" y1="84.3672" y2="1448.7109"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="696" x2="696" y1="84.3672" y2="1448.7109"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1103.5" x2="1103.5" y1="84.3672" y2="1448.7109"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1327.5" x2="1327.5" y1="84.3672" y2="1448.7109"/><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="30" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="168" x="53" y="71.6504">Messenger-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="30" y="1447.7109"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="168" x="53" y="1473.2754">Messenger-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="356" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="189" x="368.5" y="71.6504">Matrix-Homeserver</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="356" y="1447.7109"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="189" x="368.5" y="1473.2754">Matrix-Homeserver</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="231" x="581" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="217" x="588" y="71.6504">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="231" x="581" y="1447.7109"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="217" x="588" y="1473.2754">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="996.5" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="1049.5" y="71.6504">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="996.5" y="1447.7109"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="1049.5" y="1473.2754">FHIR-Proxy</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1220.5" y="46.0859"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="144" x="1255.5" y="71.6504">OAuth-Service</text><rect fill="#EFEFFF" height="37.2813" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="1220.5" y="1447.7109"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="144" x="1255.5" y="1473.2754">OAuth-Service</text><rect fill="#DCDCDC" height="1234.8242" style="stroke:#000000;stroke-width:1.0;" width="10" x="132" y="156.8867"/><rect fill="#DCDCDC" height="1143.0352" style="stroke:#000000;stroke-width:1.0;" width="10" x="691.5" y="156.8867"/><rect fill="#DCDCDC" height="755.2344" style="stroke:#000000;stroke-width:1.0;" width="10" x="1098.5" y="510.8984"/><rect fill="#DCDCDC" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1322.5" y="299.9531"/><polygon fill="#000000" points="679.5,152.8867,689.5,156.8867,679.5,160.8867,683.5,156.8867" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="685.5" y1="156.8867" y2="156.8867"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="287" x="149" y="150.8774">GET /I_internVerification (Version)</text><path d="M706,124.3672 L706,171.3672 L954,171.3672 L954,134.3672 L944,124.3672 L706,124.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M944,124.3672 L944,134.3672 L954,134.3672 L944,124.3672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="174" x="712" y="144.2188">Schnittstelle wird nicht</text><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="227" x="712" y="162.8438">durch die gematik spezifiziert</text><path d="M571,208.6172 L635,208.6172 L635,215.75 L625,225.75 L571,225.75 L571,208.6172 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="224.7031" style="stroke:#000000;stroke-width:1.5;" width="941.5" x="571" y="208.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="586" y="221.6841">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="650" y="226.6479">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="313" x="655" y="225.4688">kein gültiges provider-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="968" y="226.6479">]</text><polygon fill="#000000" points="1310.5,295.9531,1320.5,299.9531,1310.5,303.9531,1314.5,299.9531" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="701.5" x2="1316.5" y1="299.9531" y2="299.9531"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="356" x="708.5" y="274.1548">GET /authenticate (client_id, client_secret)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="708.5" y="293.9438">(OAuth Client credentials flow)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1332.5" x2="1374.5" y1="353.5313" y2="353.5313"/><line style="stroke:#000000;stroke-width:1.0;" x1="1374.5" x2="1374.5" y1="353.5313" y2="366.5313"/><line style="stroke:#000000;stroke-width:1.0;" x1="1333.5" x2="1374.5" y1="366.5313" y2="366.5313"/><polygon fill="#000000" points="1343.5,362.5313,1333.5,366.5313,1343.5,370.5313,1339.5,366.5313" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="156" x="1339.5" y="327.7329">prüfe client_id und</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="105" x="1339.5" y="347.522">client_secret</text><polygon fill="#000000" points="712.5,396.3203,702.5,400.3203,712.5,404.3203,708.5,400.3203" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="706.5" x2="1326.5" y1="400.3203" y2="400.3203"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="236" x="1084.5" y="394.311">status, provider-accesstoken</text><polygon fill="#000000" points="1086.5,506.8984,1096.5,510.8984,1086.5,514.8984,1090.5,510.8984" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="701.5" x2="1092.5" y1="510.8984" y2="510.8984"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="373" x="708.5" y="485.1001">GET /tim-provider-services/getFederationList</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="261" x="708.5" y="504.8892">(provider-accesstoken, Version)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1108.5" x2="1150.5" y1="564.4766" y2="564.4766"/><line style="stroke:#000000;stroke-width:1.0;" x1="1150.5" x2="1150.5" y1="564.4766" y2="577.4766"/><line style="stroke:#000000;stroke-width:1.0;" x1="1109.5" x2="1150.5" y1="577.4766" y2="577.4766"/><polygon fill="#000000" points="1119.5,573.4766,1109.5,577.4766,1119.5,581.4766,1115.5,577.4766" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1115.5" y="538.6782">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="175" x="1115.5" y="558.4673">provider-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1108.5" x2="1150.5" y1="656.0547" y2="656.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="1150.5" x2="1150.5" y1="656.0547" y2="669.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="1109.5" x2="1150.5" y1="669.0547" y2="669.0547"/><polygon fill="#000000" points="1119.5,665.0547,1109.5,669.0547,1119.5,673.0547,1115.5,669.0547" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="1115.5" y="630.2563">prüfe übergebene</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="62" x="1115.5" y="650.0454">Version</text><polygon fill="#000000" points="712.5,723.8438,702.5,727.8438,712.5,731.8438,708.5,727.8438" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="706.5" x2="1097.5" y1="727.8438" y2="727.8438"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="280" x="811.5" y="721.8345">status (aktuell oder nicht aktuell)</text><path d="M10,767.8438 L74,767.8438 L74,774.9766 L64,784.9766 L10,784.9766 L10,767.8438 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="663.8672" style="stroke:#000000;stroke-width:1.5;" width="1210.5" x="10" y="767.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="780.9106">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="89" y="785.8745">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="403" x="94" y="784.6953">Version vom Registrierungs-Dienst ist aktuell</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="497" y="785.8745">]</text><line style="stroke:#000000;stroke-width:1.0;" x1="701.5" x2="743.5" y1="878.9688" y2="878.9688"/><line style="stroke:#000000;stroke-width:1.0;" x1="743.5" x2="743.5" y1="878.9688" y2="891.9688"/><line style="stroke:#000000;stroke-width:1.0;" x1="702.5" x2="743.5" y1="891.9688" y2="891.9688"/><polygon fill="#000000" points="712.5,887.9688,702.5,891.9688,712.5,895.9688,708.5,891.9688" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="165" x="708.5" y="833.3813">Prüfung der Version</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="181" x="708.5" y="853.1704">Registrierungs-Dienst</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="179" x="708.5" y="872.9595">und Messenger-Proxy</text><path d="M20,931.9688 L84,931.9688 L84,939.1016 L74,949.1016 L20,949.1016 L20,931.9688 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="255.75" style="stroke:#000000;stroke-width:1.5;" width="802" x="20" y="931.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="35" y="945.0356">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="99" y="949.9995">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="366" x="104" y="948.8203">Version vom Messenger-Proxy ist aktuell</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="470" y="949.9995">]</text><polygon fill="#000000" points="153,999.5156,143,1003.5156,153,1007.5156,149,1003.5156" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="690.5" y1="1003.5156" y2="1003.5156"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="51" x="633.5" y="997.5063">status</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="822" y1="1037.5156" y2="1037.5156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="25" y="1053.5464">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="210" x="30" y="1052.3672">Version ist nicht aktuell</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="240" y="1053.5464">]</text><polygon fill="#000000" points="153,1078.9297,143,1082.9297,153,1086.9297,149,1082.9297" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="690.5" y1="1082.9297" y2="1082.9297"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="537.5" y="1076.9204">Föderationsliste[]</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="184" y1="1141.7188" y2="1141.7188"/><line style="stroke:#000000;stroke-width:1.0;" x1="184" x2="184" y1="1141.7188" y2="1154.7188"/><line style="stroke:#000000;stroke-width:1.0;" x1="143" x2="184" y1="1154.7188" y2="1154.7188"/><polygon fill="#000000" points="153,1150.7188,143,1154.7188,153,1158.7188,149,1154.7188" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="302" x="149" y="1135.7095">Signatur der Föderationsliste prüfen</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1220.5" y1="1220.7188" y2="1220.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="15" y="1236.7495">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="453" x="20" y="1235.5703">Version vom Registrierungs-Dienst ist nicht aktuell</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="473" y="1236.7495">]</text><polygon fill="#000000" points="712.5,1262.1328,702.5,1266.1328,712.5,1270.1328,708.5,1266.1328" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="706.5" x2="1102.5" y1="1266.1328" y2="1266.1328"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="949.5" y="1260.1235">Föderationsliste[]</text><polygon fill="#000000" points="153,1295.9219,143,1299.9219,153,1303.9219,149,1299.9219" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="695.5" y1="1299.9219" y2="1299.9219"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="147" x="542.5" y="1293.9126">Föderationsliste[]</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="184" y1="1358.7109" y2="1358.7109"/><line style="stroke:#000000;stroke-width:1.0;" x1="184" x2="184" y1="1358.7109" y2="1371.7109"/><line style="stroke:#000000;stroke-width:1.0;" x1="143" x2="184" y1="1371.7109" y2="1371.7109"/><polygon fill="#000000" points="153,1367.7109,143,1371.7109,153,1375.7109,149,1371.7109" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="302" x="149" y="1352.7017">Signatur der Föderationsliste prüfen</text><!--MD5=[ca54577a4539b8f42f77e68ef3b643ab]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    box <size:18>Messenger-Service\n #WhiteSmoke
    participant MP as "Messenger-Proxy"
    participant MH as "Matrix-Homeserver"
    end box
    participant RD as "Registrierungs-Dienst"
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant AS as "OAuth-Service"
    end box

  |||
  MP->RD: GET /I_internVerification (Version) 
  note right: <size:16>Schnittstelle wird nicht \n<size:16>durch die gematik spezifiziert</size>
  |||
    Activate MP
    Activate RD


  alt#LightGrey #AliceBlue <size:16>kein gültiges provider-accesstoken</size>
    |||
    RD->AS: GET /authenticate (client_id, client_secret) \n(OAuth Client credentials flow)
      Activate AS
    AS->AS: prüfe client_id und \nclient_secret
    AS- ->RD: status, provider-accesstoken 
      Deactivate AS  
    |||
  end

  |||
  RD->FP: GET /tim-provider-services/getFederationList \n(provider-accesstoken, Version)
    Activate FP
  FP->FP: prüfe \nprovider-accesstoken
  |||
  FP->FP: prüfe übergebene \nVersion

|||

  FP- ->RD: status (aktuell oder nicht aktuell)
  |||
  
alt#LightGrey #AliceBlue <size:16>Version vom Registrierungs-Dienst ist aktuell</size>
    |||
    RD->RD: Prüfung der Version \nRegistrierungs-Dienst \nund Messenger-Proxy
      
      |||
      alt#LightGrey #LightBlue <size:16>Version vom Messenger-Proxy ist aktuell</size>
      ||| 
          RD- ->MP: status
          |||
          
          else <size:16>Version ist nicht aktuell</size>
            RD- ->MP: Föderationsliste[]
            |||
            MP->MP: Signatur der Föderationsliste prüfen
            |||
      end
    |||
    
    else <size:16>Version vom Registrierungs-Dienst ist nicht aktuell</size>
       FP- ->RD: Föderationsliste[]
        Deactivate FP
      RD- ->MP: Föderationsliste[]
        Deactivate RD
      |||
      MP->MP: Signatur der Föderationsliste prüfen
      'Needed for correct deactivation in case last message is message to itself
      MP-[hidden]->MP
        deactivate MP
    |||
end
@enduml

@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    box <size:18>Messenger-Service\n #WhiteSmoke
    participant MP as "Messenger-Proxy"
    participant MH as "Matrix-Homeserver"
    end box
    participant RD as "Registrierungs-Dienst"
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant AS as "OAuth-Service"
    end box

  |||
  MP->RD: GET /I_internVerification (Version) 
  note right: <size:16>Schnittstelle wird nicht \n<size:16>durch die gematik spezifiziert</size>
  |||
    Activate MP
    Activate RD


  alt#LightGrey #AliceBlue <size:16>kein gültiges provider-accesstoken</size>
    |||
    RD->AS: GET /authenticate (client_id, client_secret) \n(OAuth Client credentials flow)
      Activate AS
    AS->AS: prüfe client_id und \nclient_secret
    AS- ->RD: status, provider-accesstoken 
      Deactivate AS  
    |||
  end

  |||
  RD->FP: GET /tim-provider-services/getFederationList \n(provider-accesstoken, Version)
    Activate FP
  FP->FP: prüfe \nprovider-accesstoken
  |||
  FP->FP: prüfe übergebene \nVersion

|||

  FP- ->RD: status (aktuell oder nicht aktuell)
  |||
  
alt#LightGrey #AliceBlue <size:16>Version vom Registrierungs-Dienst ist aktuell</size>
    |||
    RD->RD: Prüfung der Version \nRegistrierungs-Dienst \nund Messenger-Proxy
      
      |||
      alt#LightGrey #LightBlue <size:16>Version vom Messenger-Proxy ist aktuell</size>
      ||| 
          RD- ->MP: status
          |||
          
          else <size:16>Version ist nicht aktuell</size>
            RD- ->MP: Föderationsliste[]
            |||
            MP->MP: Signatur der Föderationsliste prüfen
            |||
      end
    |||
    
    else <size:16>Version vom Registrierungs-Dienst ist nicht aktuell</size>
       FP- ->RD: Föderationsliste[]
        Deactivate FP
      RD- ->MP: Föderationsliste[]
        Deactivate RD
      |||
      MP->MP: Signatur der Föderationsliste prüfen
      MP-[hidden]->MP
        deactivate MP
    |||
end
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>
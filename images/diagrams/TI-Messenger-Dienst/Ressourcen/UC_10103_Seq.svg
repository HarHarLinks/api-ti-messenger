<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2920px" preserveAspectRatio="none" style="width:1556px;height:2920px;background:#FFFFFF;" version="1.1" viewBox="0 0 1556 2920" width="1556px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="2908" style="stroke:#181818;stroke-width:0.5;" width="405" x="307.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="19" font-weight="bold" lengthAdjust="spacing" textLength="85" x="465.5" y="25.7236">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="550.5" y="27.042"> </text><rect fill="#DCDCDC" height="2471.1328" style="stroke:#000000;stroke-width:1.0;" width="10" x="418" y="254.5547"/><rect fill="#DCDCDC" height="288.1328" style="stroke:#000000;stroke-width:1.0;" width="10" x="621.5" y="546.1953"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="888.5" y="581.5781"/><rect fill="#DCDCDC" height="117.582" style="stroke:#000000;stroke-width:1.0;" width="10" x="1081.5" y="332.8477"/><rect fill="#DCDCDC" height="1357.8984" style="stroke:#000000;stroke-width:1.0;" width="10" x="1081.5" y="930.0938"/><rect fill="#DCDCDC" height="237.3477" style="stroke:#000000;stroke-width:1.0;" width="10" x="1081.5" y="2452.957"/><rect fill="#DCDCDC" height="358.8984" style="stroke:#000000;stroke-width:1.0;" width="10" x="1443.5" y="510.8125"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1443.5" y="965.4766"/><rect fill="#F0F8FF" height="2601.375" style="stroke:#000000;stroke-width:1.5;" width="1540.5" x="10" y="157.3125"/><rect fill="#ADD8E6" height="1434.1719" style="stroke:#000000;stroke-width:1.5;" width="1520.5" x="20" y="269.5547"/><rect fill="#FFE4E1" height="117.9844" style="stroke:#000000;stroke-width:1.5;" width="688.5" x="30" y="656.9609"/><rect fill="#ADD8E6" height="483.9531" style="stroke:none;stroke-width:1.0;" width="1520.5" x="20" y="1219.7734"/><rect fill="#FFE4E1" height="139.3672" style="stroke:#000000;stroke-width:1.5;" width="1167.5" x="30" y="1742.7266"/><rect fill="#FFE4E1" height="139.3672" style="stroke:#000000;stroke-width:1.5;" width="1167.5" x="30" y="2089.2422"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="124" x2="124" y1="115.3125" y2="2800.6875"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="422.5" x2="422.5" y1="115.3125" y2="2800.6875"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="626.5" x2="626.5" y1="115.3125" y2="2800.6875"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="893.5" x2="893.5" y1="115.3125" y2="2800.6875"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1086.5" x2="1086.5" y1="115.3125" y2="2800.6875"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1448.5" x2="1448.5" y1="115.3125" y2="2800.6875"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="40" y="85.7617">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="95" x="73.5" y="110.918">Org-Admin</text><ellipse cx="124" cy="13.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M124,21.5 L124,48.5 M111,29.5 L137,29.5 M124,48.5 L111,63.5 M124,48.5 L137,63.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="162" x="40" y="2820.4492">Akteur in der Rolle</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="95" x="73.5" y="2845.6055">Org-Admin</text><ellipse cx="124" cy="2858.5" fill="#DCDCDC" rx="8" ry="8" style="stroke:#000000;stroke-width:0.5;"/><path d="M124,2866.5 L124,2893.5 M111,2874.5 L137,2874.5 M124,2893.5 L111,2908.5 M124,2893.5 L137,2908.5 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><rect fill="#EFEFFF" height="64.3125" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="223" x="311.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="116" x="362" y="77.7617">Frontend des</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="209" x="318.5" y="102.918">Registrierungs-Dienstes</text><rect fill="#EFEFFF" height="64.3125" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="223" x="311.5" y="2799.6875"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="116" x="362" y="2827.4492">Frontend des</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="209" x="318.5" y="2852.6055">Registrierungs-Dienstes</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="164" x="544.5" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="115" x="569" y="102.918">Authenticator</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="164" x="544.5" y="2799.6875"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="115" x="569" y="2827.4492">Authenticator</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="164" x="811.5" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="89" x="849" y="102.918">Konnektor</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="164" x="811.5" y="2799.6875"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="89" x="849" y="2827.4492">Konnektor</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="202" x="985.5" y="75.1563"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="188" x="992.5" y="102.918">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="39.1563" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="202" x="985.5" y="2799.6875"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="188" x="992.5" y="2827.4492">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="64.3125" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="164" x="1366.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="76" x="1407.5" y="77.7617">zentraler</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="95" x="1401" y="102.918">IDP-Dienst</text><rect fill="#EFEFFF" height="64.3125" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="164" x="1366.5" y="2799.6875"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="76" x="1407.5" y="2827.4492">zentraler</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="95" x="1401" y="2852.6055">IDP-Dienst</text><rect fill="#DCDCDC" height="2471.1328" style="stroke:#000000;stroke-width:1.0;" width="10" x="418" y="254.5547"/><rect fill="#DCDCDC" height="288.1328" style="stroke:#000000;stroke-width:1.0;" width="10" x="621.5" y="546.1953"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="888.5" y="581.5781"/><rect fill="#DCDCDC" height="117.582" style="stroke:#000000;stroke-width:1.0;" width="10" x="1081.5" y="332.8477"/><rect fill="#DCDCDC" height="1357.8984" style="stroke:#000000;stroke-width:1.0;" width="10" x="1081.5" y="930.0938"/><rect fill="#DCDCDC" height="237.3477" style="stroke:#000000;stroke-width:1.0;" width="10" x="1081.5" y="2452.957"/><rect fill="#DCDCDC" height="358.8984" style="stroke:#000000;stroke-width:1.0;" width="10" x="1443.5" y="510.8125"/><rect fill="#DCDCDC" height="35.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="1443.5" y="965.4766"/><path d="M10,157.3125 L71,157.3125 L71,165.6641 L61,175.6641 L10,175.6641 L10,157.3125 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="2601.375" style="stroke:#000000;stroke-width:1.5;" width="1540.5" x="10" y="157.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="171.8076">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="86" y="177.0205">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="437" x="90" y="175.9219">Organisation nicht am Registrierungs-Dienst authentisiert</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="527" y="177.0205">]</text><polygon fill="#000000" points="406,250.5547,416,254.5547,406,258.5547,410,254.5547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="124" x2="412" y1="254.5547" y2="254.5547"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="131" y="238.1279">1</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="177" x="144" y="227.4365">Organisation verifizieren</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="144" y="248.8193">(Verfahren auswählen)</text><path d="M20,269.5547 L81,269.5547 L81,277.9063 L71,287.9063 L20,287.9063 L20,269.5547 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1434.1719" style="stroke:#000000;stroke-width:1.5;" width="1520.5" x="20" y="269.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="284.0498">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="96" y="289.2627">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="126" x="100" y="288.1641">OpenID Connect</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="226" y="289.2627">]</text><polygon fill="#000000" points="1069.5,328.8477,1079.5,332.8477,1069.5,336.8477,1073.5,332.8477" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="428" x2="1075.5" y1="332.8477" y2="332.8477"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="435" y="327.1123">2</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="448" y="327.1123">POST I_Registration</text><path d="M1096,298.0313 L1096,348.0313 L1319,348.0313 L1319,308.0313 L1309,298.0313 L1096,298.0313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1309,298.0313 L1309,308.0313 L1319,308.0313 L1309,298.0313 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="152" x="1102" y="319.6406">Schnittstelle wird nicht</text><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="202" x="1102" y="339.7656">durch die gematik spezifiziert</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="402.0469" y2="402.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="402.0469" y2="415.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="415.0469" y2="415.0469"/><polygon fill="#000000" points="1102.5,411.0469,1092.5,415.0469,1102.5,419.0469,1098.5,415.0469" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1098.5" y="385.6201">3</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="155" x="1111.5" y="374.9287">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="181" x="1111.5" y="396.3115">für verifier und challenge</text><polygon fill="#000000" points="439,446.4297,429,450.4297,439,454.4297,435,450.4297" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="433" x2="1085.5" y1="450.4297" y2="450.4297"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="785.5" y="444.6943">4</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="281" x="798.5" y="444.6943">Redirect to IDP Authorization Endpoint</text><polygon fill="#000000" points="1431.5,506.8125,1441.5,510.8125,1431.5,514.8125,1435.5,510.8125" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="428" x2="1437.5" y1="510.8125" y2="510.8125"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="435" y="505.0771">5</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="151" x="448" y="505.0771">GET {auth_endpoint}</text><polygon fill="#000000" points="642.5,542.1953,632.5,546.1953,642.5,550.1953,638.5,546.1953" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="636.5" x2="1442.5" y1="546.1953" y2="546.1953"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1246.5" y="540.46">6</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="177" x="1259.5" y="540.46">Authentication challenge</text><polygon fill="#000000" points="876.5,577.5781,886.5,581.5781,876.5,585.5781,880.5,581.5781" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="631.5" x2="882.5" y1="581.5781" y2="581.5781"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="638.5" y="575.8428">7</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="651.5" y="575.8428">ExternalAuthenticate</text><polygon fill="#000000" points="642.5,612.9609,632.5,616.9609,642.5,620.9609,638.5,616.9609" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="636.5" x2="892.5" y1="616.9609" y2="616.9609"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="653.5" y="611.2256">8</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="220" x="666.5" y="611.2256">ExternalAuthenticateResponse</text><path d="M30,656.9609 L111,656.9609 L111,665.3125 L101,675.3125 L30,675.3125 L30,656.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="117.9844" style="stroke:#000000;stroke-width:1.5;" width="688.5" x="30" y="656.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="36" x="45" y="671.4561">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="126" y="675.4111">[</text><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacing" textLength="191" x="130" y="674.5322">SMC-B nicht freigeschaltet</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="321" y="675.4111">]</text><polygon fill="#000000" points="439,702.5625,429,706.5625,439,710.5625,435,706.5625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="433" x2="620.5" y1="706.5625" y2="706.5625"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="9" x="487.5" y="700.8271">9</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="500.5" y="700.8271">Fehlernachricht</text><polygon fill="#000000" points="135,737.9453,125,741.9453,135,745.9453,131,741.9453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="129" x2="417" y1="741.9453" y2="741.9453"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="275" y="736.21">10</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="297" y="736.21">Fehlernachricht</text><polygon fill="#000000" points="1431.5,830.3281,1441.5,834.3281,1431.5,838.3281,1435.5,834.3281" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="626.5" x2="1437.5" y1="834.3281" y2="834.3281"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="633.5" y="828.5928">11</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="249" x="655.5" y="828.5928">Authentication challenge response</text><polygon fill="#000000" points="439,865.7109,429,869.7109,439,873.7109,435,869.7109" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="433" x2="1447.5" y1="869.7109" y2="869.7109"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1343.5" y="863.9756">12</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="76" x="1365.5" y="863.9756">auth_code</text><polygon fill="#000000" points="1069.5,926.0938,1079.5,930.0938,1069.5,934.0938,1073.5,930.0938" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="428" x2="1075.5" y1="930.0938" y2="930.0938"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="435" y="924.3584">13</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="236" x="457" y="924.3584">POST I_Registration(auth_code)</text><polygon fill="#000000" points="1431.5,961.4766,1441.5,965.4766,1431.5,969.4766,1435.5,965.4766" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1437.5" y1="965.4766" y2="965.4766"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="959.7412">14</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="311" x="1120.5" y="959.7412">POST {tokenEndpoint}(auth_code, verifier)</text><polygon fill="#000000" points="1102.5,996.8594,1092.5,1000.8594,1102.5,1004.8594,1098.5,1000.8594" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1096.5" x2="1447.5" y1="1000.8594" y2="1000.8594"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1358.5" y="995.124">15</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="61" x="1380.5" y="995.124">id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="1061.2422" y2="1061.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="1061.2422" y2="1074.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="1074.2422" y2="1074.2422"/><polygon fill="#000000" points="1102.5,1070.2422,1092.5,1074.2422,1102.5,1078.2422,1098.5,1074.2422" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="1055.5068">16</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="227" x="1120.5" y="1055.5068">ID_TOKEN validieren(id_token)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="1173.7734" y2="1173.7734"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="1173.7734" y2="1186.7734"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="1186.7734" y2="1186.7734"/><polygon fill="#000000" points="1102.5,1182.7734,1092.5,1186.7734,1102.5,1190.7734,1098.5,1186.7734" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="1135.9639">17</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="74" x="1120.5" y="1103.8896">enthaltene</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="135" x="1120.5" y="1125.2725">ProfessionOID auf</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="144" x="1120.5" y="1146.6553">gültige Organisation</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="47" x="1120.5" y="1168.0381">prüfen</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="1540.5" y1="1220.7734" y2="1220.7734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="25" y="1238.4814">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="117" x="29" y="1237.3828">KIM - Verfahren</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="146" y="1238.4814">]</text><polygon fill="#000000" points="1069.5,1290.2813,1079.5,1294.2813,1069.5,1298.2813,1073.5,1294.2813" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="124" x2="1075.5" y1="1294.2813" y2="1294.2813"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="131" y="1288.5459">18</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="463" x="153" y="1288.5459">KIM-Adresse in Eingabemaske eintragen (POST I_Registration)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="1351.0469" y2="1351.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="1351.0469" y2="1364.0469"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="1364.0469" y2="1364.0469"/><polygon fill="#000000" points="1102.5,1360.0469,1092.5,1364.0469,1102.5,1368.0469,1098.5,1364.0469" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="1334.6201">19</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="1120.5" y="1323.9287">Abfrage des LDAP-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="188" x="1120.5" y="1345.3115">Eintrags zur KIM-Adresse</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="1445.8125" y2="1445.8125"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="1445.8125" y2="1458.8125"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="1458.8125" y2="1458.8125"/><polygon fill="#000000" points="1102.5,1454.8125,1092.5,1458.8125,1102.5,1462.8125,1098.5,1458.8125" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="1429.3857">20</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="204" x="1120.5" y="1418.6943">Speicherung der telematikId</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="1120.5" y="1440.0771">und der professionOID</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="1561.9609" y2="1561.9609"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="1561.9609" y2="1574.9609"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="1574.9609" y2="1574.9609"/><polygon fill="#000000" points="1102.5,1570.9609,1092.5,1574.9609,1102.5,1578.9609,1098.5,1574.9609" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="1534.8428">21</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="135" x="1120.5" y="1513.46">ProfessionOID auf</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="144" x="1120.5" y="1534.8428">gültige Organisation</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="47" x="1120.5" y="1556.2256">prüfen</text><polygon fill="#000000" points="135,1631.3438,125,1635.3438,135,1639.3438,131,1635.3438" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="129" x2="1080.5" y1="1635.3438" y2="1635.3438"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="886.5" y="1629.6084">22</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="908.5" y="1629.6084">KIM Nachricht mit URL</text><polygon fill="#000000" points="1069.5,1666.7266,1079.5,1670.7266,1069.5,1674.7266,1073.5,1670.7266" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="124" x2="1075.5" y1="1670.7266" y2="1670.7266"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="131" y="1664.9912">23</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="210" x="153" y="1664.9912">URL in KIM-Nachricht öffnen</text><path d="M30,1742.7266 L111,1742.7266 L111,1751.0781 L101,1761.0781 L30,1761.0781 L30,1742.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="139.3672" style="stroke:#000000;stroke-width:1.5;" width="1167.5" x="30" y="1742.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="36" x="45" y="1757.2217">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="126" y="1761.1768">[</text><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacing" textLength="272" x="130" y="1760.2979">keine gültige ProfessionOID gefunden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="402" y="1761.1768">]</text><polygon fill="#000000" points="439,1788.3281,429,1792.3281,439,1796.3281,435,1792.3281" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="433" x2="1080.5" y1="1792.3281" y2="1792.3281"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="645.5" y="1786.5928">24</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="407" x="667.5" y="1786.5928">Fehlernachricht "keine gültige ProfessionOID gefunden"</text><polygon fill="#000000" points="135,1845.0938,125,1849.0938,135,1853.0938,131,1849.0938" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="129" x2="417" y1="1849.0938" y2="1849.0938"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="141" y="1832.667">25</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="163" y="1821.9756">Fehlernachricht</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="248" x="163" y="1843.3584">"Authentifizierung fehlgeschlagen"</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="1962.8594" y2="1962.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="1962.8594" y2="1975.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="1975.8594" y2="1975.8594"/><polygon fill="#000000" points="1102.5,1971.8594,1092.5,1975.8594,1102.5,1979.8594,1098.5,1975.8594" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="1946.4326">26</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="92" x="1120.5" y="1935.7412">Organisation</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="111" x="1120.5" y="1957.124">authentifizieren</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="2036.2422" y2="2036.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="2036.2422" y2="2049.2422"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="2049.2422" y2="2049.2422"/><polygon fill="#000000" points="1102.5,2045.2422,1092.5,2049.2422,1102.5,2053.2422,1098.5,2049.2422" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="2030.5068">27</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="303" x="1120.5" y="2030.5068">Prüfung auf existierenden Admin Account</text><path d="M30,2089.2422 L111,2089.2422 L111,2097.5938 L101,2107.5938 L30,2107.5938 L30,2089.2422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="139.3672" style="stroke:#000000;stroke-width:1.5;" width="1167.5" x="30" y="2089.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="36" x="45" y="2103.7373">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="126" y="2107.6924">[</text><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacing" textLength="536" x="130" y="2106.8135">Organisation bereits authentifiziert UND ein Admin-Account existiert bereits</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="666" y="2107.6924">]</text><polygon fill="#000000" points="439,2134.8438,429,2138.8438,439,2142.8438,435,2138.8438" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="433" x2="1080.5" y1="2138.8438" y2="2138.8438"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="747.5" y="2133.1084">28</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="305" x="769.5" y="2133.1084">Fehlernachricht "Account existiert bereits"</text><polygon fill="#000000" points="135,2191.6094,125,2195.6094,135,2199.6094,131,2195.6094" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="129" x2="417" y1="2195.6094" y2="2195.6094"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="203" y="2179.1826">29</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="114" x="225" y="2168.4912">Fehlernachricht</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="186" x="225" y="2189.874">"Account existiert bereits"</text><polygon fill="#000000" points="439,2283.9922,429,2287.9922,439,2291.9922,435,2287.9922" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="433" x2="1085.5" y1="2287.9922" y2="2287.9922"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1012.5" y="2282.2568">30</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="45" x="1034.5" y="2282.2568">Status</text><polygon fill="#000000" points="135,2319.375,125,2323.375,135,2327.375,131,2323.375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="129" x2="417" y1="2323.375" y2="2323.375"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="213" y="2317.6396">31</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="176" x="235" y="2317.6396">Verifizierung erfolgreich</text><polygon fill="#000000" points="406,2401.1406,416,2405.1406,406,2409.1406,410,2405.1406" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="124" x2="412" y1="2405.1406" y2="2405.1406"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="131" y="2388.7139">32</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="173" x="153" y="2378.0225">Admin Account anlegen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="163" x="153" y="2399.4053">(Passwort + 2. Faktor)</text><polygon fill="#000000" points="1069.5,2448.957,1079.5,2452.957,1069.5,2456.957,1073.5,2452.957" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="428" x2="1075.5" y1="2452.957" y2="2452.957"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="435" y="2447.2217">33</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="449" x="457" y="2447.2217">POST I_Registration (Admin-Account Credentials + 2. Faktor)</text><path d="M1096,2418.1406 L1096,2468.1406 L1319,2468.1406 L1319,2428.1406 L1309,2418.1406 L1096,2418.1406 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1309,2418.1406 L1309,2428.1406 L1319,2428.1406 L1309,2418.1406 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="152" x="1102" y="2439.75">Schnittstelle wird nicht</text><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="202" x="1102" y="2459.875">durch die gematik spezifiziert</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="2525.7734" y2="2525.7734"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="2525.7734" y2="2538.7734"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="2538.7734" y2="2538.7734"/><polygon fill="#000000" points="1102.5,2534.7734,1092.5,2538.7734,1102.5,2542.7734,1098.5,2538.7734" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="2520.0381">34</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="185" x="1120.5" y="2520.0381">Credentials-Policy prüfen</text><line style="stroke:#000000;stroke-width:1.0;" x1="1091.5" x2="1133.5" y1="2641.9219" y2="2641.9219"/><line style="stroke:#000000;stroke-width:1.0;" x1="1133.5" x2="1133.5" y1="2641.9219" y2="2654.9219"/><line style="stroke:#000000;stroke-width:1.0;" x1="1092.5" x2="1133.5" y1="2654.9219" y2="2654.9219"/><polygon fill="#000000" points="1102.5,2650.9219,1092.5,2654.9219,1102.5,2658.9219,1098.5,2654.9219" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1098.5" y="2614.8037">35</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="144" x="1120.5" y="2593.4209">Org-Admin Account</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="144" x="1120.5" y="2614.8037">für die Organisation</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="57" x="1120.5" y="2636.1865">anlegen</text><polygon fill="#000000" points="439,2686.3047,429,2690.3047,439,2694.3047,435,2690.3047" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="433" x2="1085.5" y1="2690.3047" y2="2690.3047"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1012.5" y="2684.5693">36</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="45" x="1034.5" y="2684.5693">Status</text><polygon fill="#000000" points="135,2721.6875,125,2725.6875,135,2729.6875,131,2725.6875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="129" x2="422" y1="2725.6875" y2="2725.6875"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacing" textLength="18" x="268" y="2719.9521">37</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="126" x="290" y="2719.9521">Account angelegt</text><!--MD5=[4900e17b3e657b0fd30bc6136e5dc43e]
@startuml "Authentisieren einer Organisation am TI-Messenger-Dienst"
skinparam sequenceMessageAlign direction
skinparam WrapWidth 300
skinparam minClassWidth 150
skinparam BoxPadding 1
scale max 2048 width
autonumber

skinparam sequence {
  ArrowColor black
  ArrowFontSize 17
  ActorBorderColor black
  LifeLineBorderColor black
  LifeLineBackgroundColor Gainsboro

  ParticipantBorderColor Motivation
  ParticipantBackgroundColor Motivation
  ParticipantFontSize 20
  ParticipantFontColor black
  ParticipantBorderColor Black
  ParticipantBackgroundColor MOTIVATION

  ActorBackgroundColor Gainsboro
  ActorFontColor black
  ActorFontSize 20
}

actor oa as "Akteur in der Rolle\nOrg-Admin"
  box <size:19>Endgerät</size> #WhiteSmoke
  participant wb as "Frontend des \nRegistrierungs-Dienstes"
  participant au as "Authenticator"
  end box
participant ko as "Konnektor"
participant rd as "Registrierungs-Dienst"
participant ip as "zentraler \nIDP-Dienst"



|||
alt#LightGrey #AliceBlue <size:16>Organisation nicht am Registrierungs-Dienst authentisiert</size>
|||
      oa -> wb: Organisation verifizieren \n(Verfahren auswählen)
      alt#LightGrey #LightBlue <size:16>OpenID Connect</size>
          activate wb
        wb -> rd:POST I_Registration
        note right: <size:16>Schnittstelle wird nicht \n<size:16>durch die gematik spezifiziert</size>
          activate rd
        rd->rd: Erzeuge PKCE Code \nfür verifier und challenge
        rd - -> wb: Redirect to IDP Authorization Endpoint
          deactivate rd
        |||
        wb -> ip: GET {auth_endpoint}
        activate ip
        ip -> au: Authentication challenge
        activate au
        au -> ko: ExternalAuthenticate
          activate ko
        ko - -> au: ExternalAuthenticateResponse
        |||
          deactivate ko
      
      break #MistyRose <size:15>SMC-B nicht freigeschaltet</size>
        au -> wb: Fehlernachricht
        wb -> oa: Fehlernachricht
        |||
      end
        |||
        au - ->ip: Authentication challenge response
          deactivate au
        ip - -> wb: auth_code
          deactivate ip
        |||
        wb -> rd: POST I_Registration(auth_code)
          activate rd
        rd -> ip: POST {tokenEndpoint}(auth_code, verifier)
          activate ip
        ip - -> rd: id_token
          deactivate ip
        |||
        rd -> rd: ID_TOKEN validieren(id_token)
        rd -> rd: enthaltene \nProfessionOID auf \ngültige Organisation \nprüfen
        |||
      else <size:16>KIM - Verfahren</size>
        |||
        oa -> rd: KIM-Adresse in Eingabemaske eintragen (POST I_Registration)
        rd -> rd: Abfrage des LDAP-Directory\nEintrags zur KIM-Adresse
        |||
        rd -> rd: Speicherung der telematikId\nund der professionOID
        |||
        rd -> rd: ProfessionOID auf\ngültige Organisation\nprüfen
        |||
        rd -> oa: KIM Nachricht mit URL
        oa -> rd: URL in KIM-Nachricht öffnen
        |||
      end
      |||

    break #MistyRose <size:15>keine gültige ProfessionOID gefunden</size>
      rd -> wb: Fehlernachricht "keine gültige ProfessionOID gefunden"
      wb -> oa: Fehlernachricht \n"Authentifizierung fehlgeschlagen"
      |||
    end

      |||
      rd-> rd: Organisation \nauthentifizieren
      |||
      rd -> rd : Prüfung auf existierenden Admin Account
      |||
        break #MistyRose <size:15>Organisation bereits authentifiziert UND ein Admin-Account existiert bereits</size>
         rd -> wb: Fehlernachricht "Account existiert bereits"
         wb -> oa: Fehlernachricht \n"Account existiert bereits"
         |||
        end
      |||
      rd - -> wb: Status
        deactivate rd
      wb - -> oa: Verifizierung erfolgreich
      |||
      oa -> wb: Admin Account anlegen \n(Passwort + 2. Faktor)
      wb -> rd: POST I_Registration (Admin-Account Credentials + 2. Faktor)
      note right: <size:16>Schnittstelle wird nicht \n<size:16>durch die gematik spezifiziert</size>
        activate rd
      |||
      rd -> rd: Credentials-Policy prüfen
      |||
      rd -> rd: Org-Admin Account\nfür die Organisation \nanlegen
      rd - -> wb: Status
       deactivate rd
      wb - -> oa: Account angelegt
       deactivate wb
      |||
end
|||
@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: de
Country: DE
--></g></svg>